import{_ as Q,u as X,I as F,J as Z,a5 as R,b,o as i,c as _,d as n,a as t,w as d,f as H,t as x,a6 as me,e as U,F as M,y as q,A as Y,n as z}from"./index-D1uxBxpa.js";import{s as $,a as _e}from"./index-CZva3LPW.js";import{s as ee,c as te,a as ae,b as le}from"./index-BIeAlUJT.js";import{s as ne}from"./index-7jlECg0w.js";import{s as de}from"./index-SJxkweTD.js";import{s as oe}from"./index-B_dfm8Z3.js";import{s as se}from"./index-BeoBpIal.js";import{s as ie,a as re,b as ue,c as ce}from"./index-CkOVRJJ4.js";import{s as fe}from"./index-CBYPfZAM.js";import"./index-DU-Aobhb.js";import"./index-OFUA_Emm.js";import"./index-UcX-Yj_6.js";import"./index-BRLBpJjm.js";import"./index-Dgpi_Il-.js";const pe={name:"ManagePlanAddon",props:{plan:{type:Object,required:!0}},emits:["update-filtered-conditions"],components:{Button:$,Dialog:ee,FloatLabel:ne,Select:de,InputNumber:te,InputText:oe,DatePicker:se,Accordion:ie,AccordionPanel:re,AccordionHeader:ue,AccordionContent:ce,DataTable:ae,Column:le},setup(f,{emit:e}){const S=X(),a=F({plans_global_id:f.plan.plans_global_id,plans_hotel_id:f.plan.plans_hotel_id,hotel_id:f.plan.hotel_id,date:f.plan.date}),h=F({hotel_id:null,plans_global_id:null,plans_hotel_id:null,addons_id:null,date_start:new Date().toISOString().split("T")[0],date_end:null,price:0}),p=F({id:null,price:0,date_start:null,date_end:null}),C=F([]),D=F([]),u=F(!1),c=F(!1),w=()=>{h.value.plans_global_id=f.plan.plans_global_id,h.value.plans_hotel_id=f.plan.plans_hotel_id,h.value.hotel_id=f.plan.hotel_id,V(),u.value=!0},I=l=>{p.value={...l},c.value=!0},V=async()=>{const l=a.value.hotel_id;try{const o=localStorage.getItem("authToken"),s=await fetch(`/api/addons/all/${l}`,{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const g=await s.json();C.value=g}catch(o){console.error("Error fetching global addons:",o),o.value=o.message||"Failed to fetch global addons"}finally{}},T=async()=>{const l=o=>{if(!o)return null;const s=new Date(o),g=String(s.getFullYear()),j=String(s.getMonth()+1).padStart(2,"0"),J=String(s.getDate()).padStart(2,"0");return`${g}-${j}-${J}`};try{const o=localStorage.getItem("authToken"),s=await fetch(`/api/plans/${a.value.plans_global_id}/${a.value.plans_hotel_id}/${a.value.hotel_id}/addons`,{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error("Failed to fetch addons");const g=await s.json();D.value=g.map(j=>({...j,date_start:l(j.date_start),date_end:l(j.date_end)})),P()}catch(o){console.error("Error fetching addons:",o)}},E=async()=>{if(h.value.date_end&&new Date(h.value.date_end)<new Date(h.value.date_start)){S.add({severity:"error",summary:"Error",detail:"End date must be equal to or greater than start date.",life:3e3});return}const l=s=>{if(!s)return null;const g=new Date(s),j=g.getFullYear(),J=String(g.getMonth()+1).padStart(2,"0"),W=String(g.getDate()).padStart(2,"0");return`${j}-${J}-${W}`},o={...h.value,date_start:l(h.value.date_start),date_end:l(h.value.date_end)};try{const s=localStorage.getItem("authToken");if(!(await fetch("/api/plans/addons",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Failed to save addon");T(),u.value=!1,h.value={hotel_id:null,plans_global_id:null,plans_hotel_id:null,addons_id:null,date_start:new Date().toISOString().split("T")[0],date_end:null,price:0},S.add({severity:"success",summary:"Success",detail:"Addon created successfully",life:3e3})}catch(s){console.error("Error saving adjustment:",s)}},L=async()=>{if(p.value.date_end&&new Date(p.value.date_end)<new Date(p.value.date_start)){S.add({severity:"error",summary:"Error",detail:"End date must be equal to or greater than start date.",life:3e3});return}const l=s=>{if(!s)return null;const g=new Date(s),j=g.getFullYear(),J=String(g.getMonth()+1).padStart(2,"0"),W=String(g.getDate()).padStart(2,"0");return`${j}-${J}-${W}`},o={...p.value,date_start:l(p.value.date_start),date_end:l(p.value.date_end)};try{const s=localStorage.getItem("authToken");if(!(await fetch(`/api/plans/addons/${p.value.id}`,{method:"PUT",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Failed to update adjustment");T(),c.value=!1,p.value={id:null,price:0,date_start:null,date_end:null},S.add({severity:"success",summary:"Success",detail:"Addon updated successfully",life:3e3})}catch(s){console.error("Error updating addon:",s),S.add({severity:"error",summary:"Error",detail:"An error occurred while updating the addon.",life:3e3})}};Z(T);const N=R({get(){return h.value.addons_hotel_id?null:h.value.addons_global_id},set(l){h.value.addons_hotel_id?h.value.addons_hotel_id=l:h.value.addons_global_id=l}}),k=R(()=>{const l=a.value.date;if(!l)return null;const o=new Date(l);return o.setHours(0,0,0,0),D.value.filter(s=>{const g=new Date(s.date_start);g.setHours(0,0,0,0);const j=s.date_end?new Date(s.date_end):null;return j&&j.setHours(0,0,0,0),o>=g&&(j?o<=j:!0)})}),B=R(()=>{const l=a.value.date;if(!l)return null;const o=new Date(l);return o.setHours(0,0,0,0),D.value.filter(s=>{const g=new Date(s.date_start);return g.setHours(0,0,0,0),g>o})}),m=R(()=>{const l=a.value.date;if(!l)return null;const o=new Date(l);return o.setHours(0,0,0,0),D.value.filter(s=>{const g=new Date(s.date_start);g.setHours(0,0,0,0);const j=s.date_end?new Date(s.date_end):null;return j&&j.setHours(0,0,0,0),g<o&&j!=null})}),P=()=>{console.log("Sending filtered conditions:",k.value),e("update-filtered-conditions",k.value)};return{planInfo:a,newAddon:h,editAddon:p,allAddons:C,showAddonDialog:u,showEditAddonDialog:c,openAddonDialog:w,openEditAddonDialog:I,addAddon:E,updateAddon:L,selectAddons:N,filteredCurrentConditions:k,filteredFutureConditions:B,filteredPastConditions:m,sendFilteredConditions:P}},methods:{onAddonChange(){const f=this.allAddons.find(e=>e.id===this.newAddon.addons_id);f&&(this.newAddon.price=f.price)},formatNumber(f,e){if(e==="currency")return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",minimumFractionDigits:0,maximumFractionDigits:0}).format(f);if(e==="decimal")return new Intl.NumberFormat("ja-JP",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(f)}}},ve={key:0},ye={class:"grid xs:grid-cols-1 grid-cols-3 gap-2 mt-6"},be={class:"flex justify-start"},ge={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 gap-y-6 pt-6"},Ae={class:"col-6"},he={class:"col-6"},we={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 gap-y-6 pt-6"},je={class:"col-6"},De={class:"col-6"},Ce={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 gap-y-6 pt-6"},ke={class:"col-6"},Se={class:"col-6"},Ve={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 gap-y-6 pt-6"},Fe={class:"col-6"},Ee={class:"col-6"},xe={key:1};function Te(f,e,S,a,h,p){const C=b("Button"),D=b("AccordionHeader"),u=b("Column"),c=b("DataTable"),w=b("AccordionContent"),I=b("AccordionPanel"),V=b("Accordion"),T=b("Select"),E=b("FloatLabel"),L=b("InputNumber"),N=b("DatePicker"),k=b("Dialog"),B=b("InputText");return S.plan?(i(),_("div",ve,[n("div",null,[n("div",ye,[e[12]||(e[12]=n("div",{class:"flex justify-start"},[n("span",{class:"font-bold text-lg"},"Add-ons")],-1)),n("div",be,[t(C,{onClick:a.openAddonDialog,label:"Add New Addon",icon:"pi pi-plus"},null,8,["onClick"])])]),t(V,{value:"0"},{default:d(()=>[t(I,{value:"0"},{default:d(()=>[t(D,null,{default:d(()=>e[13]||(e[13]=[H("Current Add-ons")])),_:1}),t(w,null,{default:d(()=>[t(c,{value:a.filteredCurrentConditions},{default:d(()=>[t(u,{field:"date_start",header:"Start"}),t(u,{field:"date_end",header:"End"}),t(u,{field:"name",header:"Addon"}),t(u,{field:"price",header:"Price"},{body:d(m=>[H(x(p.formatNumber(m.data.price,"currency")),1)]),_:1}),t(u,{header:"Actions"},{body:d(m=>[t(C,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:P=>a.openEditAddonDialog(m.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(I,{value:"1"},{default:d(()=>[t(D,null,{default:d(()=>e[14]||(e[14]=[H("Future Add-ons")])),_:1}),t(w,null,{default:d(()=>[t(c,{value:a.filteredFutureConditions},{default:d(()=>[t(u,{field:"date_start",header:"Start"}),t(u,{field:"date_end",header:"End"}),t(u,{field:"name",header:"Addon"}),t(u,{field:"price",header:"Price"},{body:d(m=>[H(x(p.formatNumber(m.data.price,"currency")),1)]),_:1}),t(u,{header:"Actions"},{body:d(m=>[t(C,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:P=>a.openEditAddonDialog(m.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(I,{value:"2"},{default:d(()=>[t(D,null,{default:d(()=>e[15]||(e[15]=[H("Past Add-ons")])),_:1}),t(w,null,{default:d(()=>[t(c,{value:a.filteredPastConditions},{default:d(()=>[t(u,{field:"date_start",header:"Start"}),t(u,{field:"date_end",header:"End"}),t(u,{field:"name",header:"Addon"}),t(u,{field:"price",header:"Price"},{body:d(m=>[H(x(p.formatNumber(m.data.price,"currency")),1)]),_:1}),t(u,{header:"Actions"},{body:d(m=>[t(C,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:P=>a.openEditAddonDialog(m.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(k,{header:"New Addon",visible:a.showAddonDialog,"onUpdate:visible":e[5]||(e[5]=m=>a.showAddonDialog=m),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:d(()=>[t(C,{label:"Add",icon:"pi pi-plus",onClick:a.addAddon,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),t(C,{label:"Close",icon:"pi pi-times",onClick:e[4]||(e[4]=m=>a.showAddonDialog=!1),class:"p-button-danger p-button-text p-button-sm"})]),default:d(()=>[n("div",ge,[n("div",Ae,[t(E,null,{default:d(()=>[e[16]||(e[16]=n("label",{for:"AddonSelectEdit",class:"block mb-2"},"Addon List",-1)),t(T,{modelValue:a.newAddon.addons_id,"onUpdate:modelValue":e[0]||(e[0]=m=>a.newAddon.addons_id=m),id:"AddonSelectEdit",options:a.allAddons,optionLabel:"name",optionValue:"id",placeholder:"Select a Global Addon",class:"w-full",filter:"",required:"",onChange:p.onAddonChange},null,8,["modelValue","options","onChange"])]),_:1})]),n("div",he,[t(E,null,{default:d(()=>[t(L,{modelValue:a.newAddon.price,"onUpdate:modelValue":e[1]||(e[1]=m=>a.newAddon.price=m),mode:"currency",currency:"JPY",locale:"ja-JP"},null,8,["modelValue"]),e[17]||(e[17]=n("label",null,"Price",-1))]),_:1})])]),n("div",we,[n("div",je,[t(E,null,{default:d(()=>[e[18]||(e[18]=n("label",{for:"dateStart"},"Start Date",-1)),t(N,{modelValue:a.newAddon.date_start,"onUpdate:modelValue":e[2]||(e[2]=m=>a.newAddon.date_start=m),dateFormat:"yy-mm-dd",class:"w-full",required:""},null,8,["modelValue"])]),_:1})]),n("div",De,[t(E,null,{default:d(()=>[e[19]||(e[19]=n("label",{for:"dateEnd"},"End Date",-1)),t(N,{modelValue:a.newAddon.date_end,"onUpdate:modelValue":e[3]||(e[3]=m=>a.newAddon.date_end=m),dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["visible"]),t(k,{header:"Edit Addon",visible:a.showEditAddonDialog,"onUpdate:visible":e[11]||(e[11]=m=>a.showEditAddonDialog=m),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:d(()=>[t(C,{label:"Update",icon:"pi pi-check",onClick:a.updateAddon,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),t(C,{label:"Close",icon:"pi pi-times",onClick:e[10]||(e[10]=m=>a.showEditAddonDialog=!1),class:"p-button-danger p-button-text p-button-sm"})]),default:d(()=>[n("div",Ce,[n("div",ke,[t(E,null,{default:d(()=>[t(B,{modelValue:a.editAddon.name,"onUpdate:modelValue":e[6]||(e[6]=m=>a.editAddon.name=m),disabled:""},null,8,["modelValue"]),e[20]||(e[20]=n("label",null,"Addon",-1))]),_:1})]),n("div",Se,[t(E,null,{default:d(()=>[t(L,{modelValue:a.editAddon.price,"onUpdate:modelValue":e[7]||(e[7]=m=>a.editAddon.price=m),mode:"currency",currency:"JPY",locale:"ja-JP"},null,8,["modelValue"]),e[21]||(e[21]=n("label",null,"Price",-1))]),_:1})])]),n("div",Ve,[n("div",Fe,[t(E,null,{default:d(()=>[e[22]||(e[22]=n("label",{for:"dateStart"},"Start Date",-1)),t(N,{modelValue:a.editAddon.date_start,"onUpdate:modelValue":e[8]||(e[8]=m=>a.editAddon.date_start=m),dateFormat:"yy-mm-dd",class:"w-full",required:""},null,8,["modelValue"])]),_:1})]),n("div",Ee,[t(E,null,{default:d(()=>[e[23]||(e[23]=n("label",{for:"dateEnd"},"End Date",-1)),t(N,{modelValue:a.editAddon.date_end,"onUpdate:modelValue":e[9]||(e[9]=m=>a.editAddon.date_end=m),dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["visible"])])])):(i(),_("div",xe,e[24]||(e[24]=[n("p",null,"Loading... or not!",-1)])))}const Ne=Q(pe,[["render",Te]]),Ue={name:"ManagePlanRate",props:{plan:{type:Object,required:!0}},data(){return{addons:[]}},components:{ManagePlansAddons:Ne,Button:$,Dialog:ee,InputNumber:te,InputText:oe,Select:de,MultiSelect:fe,DatePicker:se,FloatLabel:ne,Accordion:ie,AccordionPanel:re,AccordionHeader:ue,AccordionContent:ce,DataTable:ae,Column:le,Badge:_e},setup(f){const e=X(),S=F(new Date().toISOString().split("T")[0]),a=F({plans_global_id:f.plan.context==="global"?f.plan.id:0,plans_hotel_id:f.plan.context==="hotel"?f.plan.id:0,hotel_id:f.plan.context==="hotel"?f.plan.hotel_id:0,date:S}),h=F([]),p=F(!1),C=F(!1),D=F([]),u=F({hotel_id:null,plans_global_id:null,plans_hotel_id:null,adjustment_type:"base_rate",adjustment_value:0,condition_type:"no_restriction",condition_value:[],date_start:new Date().toISOString().split("T")[0],date_end:null}),c=F({hotel_id:null,plans_global_id:null,plans_hotel_id:null,adjustment_type:"base_rate",adjustment_value:0,condition_type:"no_restriction",condition_value:[],date_start:new Date().toISOString().split("T")[0],date_end:null}),w=[{label:"Base Rate",value:"base_rate"},{label:"Percentage",value:"percentage"},{label:"Flat Fee",value:"flat_fee"}],I=[{label:"No Restriction",value:"no_restriction"},{label:"Day of Week",value:"day_of_week"},{label:"Month",value:"month"}],V=F([]);F([]);const T=[{label:"Monday",value:"monday"},{label:"Tuesday",value:"tuesday"},{label:"Wednesday",value:"wednesday"},{label:"Thursday",value:"thursday"},{label:"Friday",value:"friday"},{label:"Saturday",value:"saturday"},{label:"Sunday",value:"sunday"}],E=[{label:"January",value:"january"},{label:"February",value:"february"},{label:"March",value:"march"},{label:"April",value:"april"},{label:"May",value:"may"},{label:"June",value:"june"},{label:"July",value:"july"},{label:"August",value:"august"},{label:"September",value:"september"},{label:"October",value:"october"},{label:"November",value:"november"},{label:"December",value:"december"}],L=async()=>{const A=v=>{if(!v)return null;const r=new Date(v),y=String(r.getFullYear()),O=String(r.getMonth()+1).padStart(2,"0"),G=String(r.getDate()).padStart(2,"0");return`${y}-${O}-${G}`};try{const v=localStorage.getItem("authToken"),r=await fetch(`/api/plans/${a.value.plans_global_id}/${a.value.plans_hotel_id}/${a.value.hotel_id}/rates`,{method:"GET",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to fetch rates");const y=await r.json();h.value=y.map(O=>({...O,date_start:A(O.date_start),date_end:A(O.date_end)}))}catch(v){console.error("Error fetching rates:",v)}},N=()=>{f.plan.context==="global"?(u.value.plans_global_id=f.plan.id,u.value.plans_hotel_id=null):f.plan.context==="hotel"&&(u.value.plans_global_id=null,u.value.plans_hotel_id=f.plan.id,u.value.hotel_id=f.plan.hotel_id),p.value=!0},k=A=>{c.value={...A},m(),C.value=!0},B=()=>{u.value.condition_type==="day_of_week"?V.value=T:u.value.condition_type==="month"?V.value=E:u.value.condition_type==="no_restriction"?(u.value.condition_value=[],V.value=[]):V.value=[]},m=()=>{c.value.condition_type==="day_of_week"?V.value=T:c.value.condition_type==="month"?V.value=E:c.value.condition_type==="no_restriction"?(c.value.condition_value=[],V.value=[]):V.value=[]},P=async()=>{if(u.value.date_end&&new Date(u.value.date_end)<new Date(u.value.date_start)){e.add({severity:"error",summary:"Error",detail:"End date must be equal to or greater than start date.",life:3e3});return}if(u.value.adjustment_value===0){e.add({severity:"error",summary:"Error",detail:"Adjustment value must be different than 0.",life:3e3});return}const A=r=>{if(!r)return null;const y=new Date(r),O=y.getFullYear(),G=String(y.getMonth()+1).padStart(2,"0"),K=String(y.getDate()).padStart(2,"0");return`${O}-${G}-${K}`},v={...u.value,date_start:A(u.value.date_start),date_end:A(u.value.date_end)};try{const r=localStorage.getItem("authToken");if(!(await fetch(`/api/plans/${f.plan.id}/rates`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(v)})).ok)throw new Error("Failed to save adjustment");L(),p.value=!1,u.value={hotel_id:null,plans_global_id:null,plans_hotel_id:null,adjustment_type:"base_rate",adjustment_value:0,condition_type:"no_restriction",condition_value:[],date_start:null,date_end:null},e.add({severity:"success",summary:"Success",detail:"Rate created successfully",life:3e3})}catch(r){console.error("Error saving adjustment:",r)}},l=async()=>{if(c.value.date_end&&new Date(c.value.date_end)<new Date(c.value.date_start)){e.add({severity:"error",summary:"Error",detail:"End date must be equal to or greater than start date.",life:3e3});return}if(c.value.adjustment_value===0){e.add({severity:"error",summary:"Error",detail:"Adjustment value must be different than 0.",life:3e3});return}const A=r=>{if(!r)return null;const y=new Date(r),O=y.getFullYear(),G=String(y.getMonth()+1).padStart(2,"0"),K=String(y.getDate()).padStart(2,"0");return`${O}-${G}-${K}`},v={...c.value,date_start:A(c.value.date_start),date_end:A(c.value.date_end)};try{const r=localStorage.getItem("authToken");if(!(await fetch(`/api/plans/rates/${c.value.id}`,{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(v)})).ok)throw new Error("Failed to update adjustment");L(),C.value=!1,c.value={hotel_id:null,plans_global_id:null,plans_hotel_id:null,adjustment_type:"base_rate",adjustment_value:0,condition_type:"no_restriction",condition_value:[],date_start:null,date_end:null,id:null},e.add({severity:"success",summary:"Success",detail:"Rate updated successfully",life:3e3})}catch(r){console.error("Error updating adjustment:",r),e.add({severity:"error",summary:"Error",detail:"An error occurred while updating the rate.",life:3e3})}},o=R(()=>{const v=j.value.filter(r=>r.adjustment_type==="base_rate").reduce((r,y)=>r+y.adjustment_value,0);return v>0?v:null}),s=R(()=>{const v=j.value.filter(r=>r.adjustment_type==="flat_fee").reduce((r,y)=>r+y.adjustment_value,0);return v>0?v:null}),g=R(()=>{const v=j.value.filter(r=>r.adjustment_type==="percentage").reduce((r,y)=>r+y.adjustment_value,0);return v>0?v:null}),j=R(()=>{if(!S.value)return null;const A=new Date(S.value);return A.setHours(0,0,0,0),h.value.filter(v=>{const r=new Date(v.date_start);r.setHours(0,0,0,0);const y=v.date_end?new Date(v.date_end):null;return y&&y.setHours(0,0,0,0),A>=r&&(y?A<=y:!0)})}),J=R(()=>{if(!S.value)return null;const A=new Date(S.value);return A.setHours(0,0,0,0),h.value.filter(v=>{const r=new Date(v.date_start);return r.setHours(0,0,0,0),r>A})}),W=R(()=>{if(!S.value)return null;const A=new Date(S.value);return A.setHours(0,0,0,0),h.value.filter(v=>{const r=new Date(v.date_start);r.setHours(0,0,0,0);const y=v.date_end?new Date(v.date_end):null;return y&&y.setHours(0,0,0,0),r<A&&y!=null})});return Z(L),me(()=>c.value.condition_value,A=>{if(typeof A=="string")try{let v=c.value.condition_value.replace(/{/g,"[").replace(/}/g,"]");const r=JSON.parse(v);D.value=Array.isArray(r)?r:[]}catch(v){console.error("Error parsing condition_value:",v),D.value=[]}else D.value=A||[]},{immediate:!0}),{planId:a,selectedDate:S,allRates:h,showAdjustmentDialog:p,showEditAdjustmentDialog:C,selectedEditConditions:D,newAdjustment:u,editAdjustment:c,adjustmentTypes:w,conditionTypes:I,conditionValues:V,daysOfWeek:T,months:E,openAdjustmentDialog:N,openEditAdjustmentDialog:k,updateConditionValues:B,updateEditConditionValues:m,saveAdjustment:P,updateAdjustment:l,filteredBaseRateSum:o,filteredFlatFeeSum:s,filteredPercentageSum:g,filteredCurrentConditions:j,filteredFutureConditions:J,filteredPastConditions:W}},methods:{formatNumber(f,e){if(e==="currency")return new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY",minimumFractionDigits:0,maximumFractionDigits:0}).format(f);if(e==="decimal")return new Intl.NumberFormat("ja-JP",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(f)},handleFilteredAddons(f){this.addons=f,console.log("Received filtered conditions in parent:",f)}},computed:{filteredAddonCount(){return this.addons.length},filteredAddonSum(){return this.addons.reduce((f,e)=>f+(e.price||0),0)}}},Ie={key:0},Le={class:"flex space-x-4 mb-4"},Be={class:"p-4 shadow-lg rounded-lg w-1/3 bg-white"},Pe={class:"p-4 shadow-lg rounded-lg w-1/3 bg-white"},Re={key:0},Oe={key:1},He={class:"p-4 shadow-lg rounded-lg w-full md:w-1/3 bg-white mb-4"},Je={key:0},Me={key:1},qe={class:"flex space-x-4"},Ye={class:"p-4 shadow-lg rounded-lg w-full md:w-1/3 bg-white mb-4"},ze={key:0},We={key:1},Ge={class:"p-4 shadow-lg rounded-lg w-full md:w-1/3 bg-white mb-4"},Ke={class:"grid xs:grid-cols-1 grid-cols-3 gap-2 mt-6"},Qe={class:"flex justify-start"},Xe={key:0},Ze={key:1},$e={key:2},et={key:3},tt={key:4},at={key:0},lt={key:1},nt={key:0},dt={key:1},ot={key:2},st={key:3},it={key:4},rt={key:0},ut={key:1},ct={key:0},mt={key:1},_t={key:2},ft={key:3},pt={key:4},vt={key:0},yt={key:1},bt={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 gap-y-6 pt-6"},gt={class:"col-6"},At={class:"col-6"},ht={class:"col-6"},wt={key:0},jt={key:1},Dt={class:"col-6"},Ct={class:"col-6"},kt={class:"col-6"},St={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 gap-y-6 pt-6"},Vt={class:"col-6"},Ft={class:"col-6"},Et={class:"col-6"},xt={key:0},Tt={key:1},Nt={class:"col-6"},Ut={class:"col-6"},It={class:"col-6"};function Lt(f,e,S,a,h,p){const C=b("DatePicker"),D=b("Button"),u=b("AccordionHeader"),c=b("Column"),w=b("Badge"),I=b("DataTable"),V=b("AccordionContent"),T=b("AccordionPanel"),E=b("Accordion"),L=b("ManagePlansAddons"),N=b("Select"),k=b("FloatLabel"),B=b("InputNumber"),m=b("MultiSelect"),P=b("Dialog");return S.plan?(i(),_("div",Ie,[n("div",Le,[n("div",Be,[e[19]||(e[19]=n("h3",{class:"text-xl font-semibold"},"Select Date:",-1)),t(C,{modelValue:a.selectedDate,"onUpdate:modelValue":e[0]||(e[0]=l=>a.selectedDate=l),class:"w-full",placeholder:"Select Date",dateFormat:"yy-mm-dd"},null,8,["modelValue"])]),n("div",Pe,[e[20]||(e[20]=n("h3",{class:"text-xl font-semibold"},"Current Base Rate:",-1)),n("div",null,[a.filteredBaseRateSum!==null?(i(),_("p",Re," Total Base Rate: "+x(p.formatNumber(a.filteredBaseRateSum,"currency")),1)):(i(),_("p",Oe,"No base rate found for the selected date."))])]),n("div",He,[e[21]||(e[21]=n("h3",{class:"text-xl font-semibold"},"Current Flat Fee Adjustments:",-1)),n("div",null,[a.filteredFlatFeeSum!==null?(i(),_("p",Je," Total Flat Fee: "+x(p.formatNumber(a.filteredFlatFeeSum,"currency")),1)):(i(),_("p",Me,"No flat fee adjustment found for the selected date."))])])]),n("div",qe,[n("div",Ye,[e[22]||(e[22]=n("h3",{class:"text-xl font-semibold"},"Current Percentage Adjustments:",-1)),n("div",null,[a.filteredPercentageSum!==null?(i(),_("p",ze," Total Percentage: "+x(p.formatNumber(a.filteredPercentageSum,"decimal"))+"% ",1)):(i(),_("p",We,"No percentage adjustment found for the selected date."))])]),n("div",Ge,[e[23]||(e[23]=n("h3",{class:"text-xl font-semibold"},"Current Addons:",-1)),n("div",null,[n("p",null,"Count: "+x(p.filteredAddonCount),1),n("p",null,"Total Price: "+x(p.formatNumber(p.filteredAddonSum,"currency")),1)])])]),n("div",null,[n("div",Ke,[e[24]||(e[24]=n("div",{class:"flex justify-start"},[n("span",{class:"font-bold text-lg"},"Conditions")],-1)),n("div",Qe,[t(D,{onClick:a.openAdjustmentDialog,label:"Add New Adjustment",icon:"pi pi-plus"},null,8,["onClick"])])]),t(E,{value:"0"},{default:d(()=>[t(T,{value:"0"},{default:d(()=>[t(u,null,{default:d(()=>e[25]||(e[25]=[H("Current Conditions")])),_:1}),t(V,null,{default:d(()=>[t(I,{value:a.filteredCurrentConditions},{default:d(()=>[t(c,{field:"date_start",header:"Start"}),t(c,{field:"date_end",header:"End"}),t(c,{header:"Rate"},{body:d(l=>[l.data.adjustment_type!=="percentage"?(i(),_("div",Xe,x(p.formatNumber(l.data.adjustment_value,"currency")),1)):(i(),_("div",Ze,x(p.formatNumber(l.data.adjustment_value,"decimal"))+"% ",1)),l.data.adjustment_type==="base_rate"?(i(),_("div",$e,[t(w,{value:"Base Rate",severity:"secondary"})])):U("",!0),l.data.adjustment_type==="flat_fee"?(i(),_("div",et,[t(w,{value:"Flat Fee",severity:"info"})])):U("",!0),l.data.adjustment_type==="percentage"?(i(),_("div",tt,[t(w,{value:"Percentage",severity:"warn"})])):U("",!0)]),_:1}),t(c,{header:"Condition"},{body:d(l=>[l.data.condition_type==="day_of_week"?(i(),_("div",at,[(i(!0),_(M,null,q(a.daysOfWeek,(o,s)=>(i(),Y(w,{key:s,value:o.label.slice(0,3),class:z([{"p-badge-success":l.data.condition_value.includes(o.label.toLowerCase()),"p-badge-secondary":!l.data.condition_value.includes(o.label.toLowerCase())},"p-m-1"])},null,8,["value","class"]))),128))])):l.data.condition_type==="month"?(i(),_("div",lt,[(i(!0),_(M,null,q(a.months,(o,s)=>(i(),Y(w,{key:s,value:o.label.slice(0,3),class:z([{"p-badge-success":l.data.condition_value.includes(o.label.toLowerCase()),"p-badge-secondary":!l.data.condition_value.includes(o.label.toLowerCase())},"p-m-1"])},null,8,["value","class"]))),128))])):U("",!0)]),_:1}),t(c,{header:"Actions"},{body:d(l=>[t(D,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:o=>a.openEditAdjustmentDialog(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(T,{value:"1"},{default:d(()=>[t(u,null,{default:d(()=>e[26]||(e[26]=[H("Future Conditions")])),_:1}),t(V,null,{default:d(()=>[t(I,{value:a.filteredFutureConditions},{default:d(()=>[t(c,{field:"date_start",header:"Start"}),t(c,{field:"date_end",header:"End"}),t(c,{header:"Rate"},{body:d(l=>[l.data.adjustment_type!=="percentage"?(i(),_("div",nt,x(p.formatNumber(l.data.adjustment_value,"currency")),1)):(i(),_("div",dt,x(p.formatNumber(l.data.adjustment_value,"decimal"))+"% ",1)),l.data.adjustment_type==="base_rate"?(i(),_("div",ot,[t(w,{value:"Base Rate",severity:"secondary"})])):U("",!0),l.data.adjustment_type==="flat_fee"?(i(),_("div",st,[t(w,{value:"Flat Fee",severity:"info"})])):U("",!0),l.data.adjustment_type==="percentage"?(i(),_("div",it,[t(w,{value:"Percentage",severity:"warn"})])):U("",!0)]),_:1}),t(c,{header:"Condition"},{body:d(l=>[l.data.condition_type==="day_of_week"?(i(),_("div",rt,[(i(!0),_(M,null,q(a.daysOfWeek,(o,s)=>(i(),Y(w,{key:s,value:o.label.slice(0,3),class:z([{"p-badge-success":l.data.condition_value.includes(o.label.toLowerCase()),"p-badge-secondary":!l.data.condition_value.includes(o.label.toLowerCase())},"p-m-1"])},null,8,["value","class"]))),128))])):l.data.condition_type==="month"?(i(),_("div",ut,[(i(!0),_(M,null,q(a.months,(o,s)=>(i(),Y(w,{key:s,value:o.label.slice(0,3),class:z([{"p-badge-success":l.data.condition_value.includes(o.label.toLowerCase()),"p-badge-secondary":!l.data.condition_value.includes(o.label.toLowerCase())},"p-m-1"])},null,8,["value","class"]))),128))])):U("",!0)]),_:1}),t(c,{header:"Actions"},{body:d(l=>[t(D,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:o=>a.openEditAdjustmentDialog(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),t(T,{value:"2"},{default:d(()=>[t(u,null,{default:d(()=>e[27]||(e[27]=[H("Past Conditions")])),_:1}),t(V,null,{default:d(()=>[t(I,{value:a.filteredPastConditions},{default:d(()=>[t(c,{field:"date_start",header:"Start"}),t(c,{field:"date_end",header:"End"}),t(c,{header:"Rate"},{body:d(l=>[l.data.adjustment_type!=="percentage"?(i(),_("div",ct,x(p.formatNumber(l.data.adjustment_value,"currency")),1)):(i(),_("div",mt,x(p.formatNumber(l.data.adjustment_value,"decimal"))+"% ",1)),l.data.adjustment_type==="base_rate"?(i(),_("div",_t,[t(w,{value:"Base Rate",severity:"secondary"})])):U("",!0),l.data.adjustment_type==="flat_fee"?(i(),_("div",ft,[t(w,{value:"Flat Fee",severity:"info"})])):U("",!0),l.data.adjustment_type==="percentage"?(i(),_("div",pt,[t(w,{value:"Percentage",severity:"warn"})])):U("",!0)]),_:1}),t(c,{header:"Condition"},{body:d(l=>[l.data.condition_type==="day_of_week"?(i(),_("div",vt,[(i(!0),_(M,null,q(a.daysOfWeek,(o,s)=>(i(),Y(w,{key:s,value:o.label.slice(0,3),class:z([{"p-badge-success":l.data.condition_value.includes(o.label.toLowerCase()),"p-badge-secondary":!l.data.condition_value.includes(o.label.toLowerCase())},"p-m-1"])},null,8,["value","class"]))),128))])):l.data.condition_type==="month"?(i(),_("div",yt,[(i(!0),_(M,null,q(a.months,(o,s)=>(i(),Y(w,{key:s,value:o.label.slice(0,3),class:z([{"p-badge-success":l.data.condition_value.includes(o.label.toLowerCase()),"p-badge-secondary":!l.data.condition_value.includes(o.label.toLowerCase())},"p-m-1"])},null,8,["value","class"]))),128))])):U("",!0)]),_:1}),t(c,{header:"Actions"},{body:d(l=>[t(D,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:o=>a.openEditAdjustmentDialog(l.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),n("div",null,[t(L,{plan:a.planId,onUpdateFilteredConditions:p.handleFilteredAddons},null,8,["plan","onUpdateFilteredConditions"])]),t(P,{header:"Add New Adjustment",visible:a.showAdjustmentDialog,"onUpdate:visible":e[9]||(e[9]=l=>a.showAdjustmentDialog=l),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:d(()=>[t(D,{label:"Save",icon:"pi pi-check",onClick:a.saveAdjustment,class:"p-button-success"},null,8,["onClick"]),t(D,{label:"Cancel",icon:"pi pi-times",onClick:e[8]||(e[8]=l=>a.showAdjustmentDialog=!1),class:"p-button-danger"})]),default:d(()=>[n("div",bt,[n("div",gt,[t(k,null,{default:d(()=>[e[28]||(e[28]=n("label",{for:"adjustmentType"},"Adjustment Type *",-1)),t(N,{modelValue:a.newAdjustment.adjustment_type,"onUpdate:modelValue":e[1]||(e[1]=l=>a.newAdjustment.adjustment_type=l),options:a.adjustmentTypes,optionLabel:"label",optionValue:"value",fluid:"",required:""},null,8,["modelValue","options"])]),_:1})]),n("div",At,[t(k,null,{default:d(()=>[e[29]||(e[29]=n("label",{for:"conditionType"},"Condition Type *",-1)),t(N,{modelValue:a.newAdjustment.condition_type,"onUpdate:modelValue":e[2]||(e[2]=l=>a.newAdjustment.condition_type=l),options:a.conditionTypes,optionLabel:"label",optionValue:"value",class:"w-full",onChange:a.updateConditionValues,required:""},null,8,["modelValue","options","onChange"])]),_:1})]),n("div",ht,[t(k,null,{default:d(()=>[e[30]||(e[30]=n("label",{for:"adjustmentValue"},"Adjustment Value *",-1)),a.newAdjustment.adjustment_type!=="percentage"?(i(),_("div",wt,[t(B,{modelValue:a.newAdjustment.adjustment_value,"onUpdate:modelValue":e[3]||(e[3]=l=>a.newAdjustment.adjustment_value=l),mode:"currency",currency:"JPY",locale:"ja-JP",class:"w-full",required:""},null,8,["modelValue"])])):(i(),_("div",jt,[t(B,{modelValue:a.newAdjustment.adjustment_value,"onUpdate:modelValue":e[4]||(e[4]=l=>a.newAdjustment.adjustment_value=l),minFractionDigits:2,maxFractionDigits:2,suffix:"%",class:"w-full",required:""},null,8,["modelValue"])]))]),_:1})]),n("div",Dt,[t(k,null,{default:d(()=>[e[31]||(e[31]=n("label",{for:"conditionValue"},"Condition Value",-1)),t(m,{modelValue:a.newAdjustment.condition_value,"onUpdate:modelValue":e[5]||(e[5]=l=>a.newAdjustment.condition_value=l),placeholder:"Condition Value",options:a.conditionValues,optionLabel:"label",optionValue:"value",maxSelectedLabels:3,class:"w-full"},null,8,["modelValue","options"])]),_:1})]),n("div",Ct,[t(k,null,{default:d(()=>[e[32]||(e[32]=n("label",{for:"dateStart"},"Start Date",-1)),t(C,{modelValue:a.newAdjustment.date_start,"onUpdate:modelValue":e[6]||(e[6]=l=>a.newAdjustment.date_start=l),dateFormat:"yy-mm-dd",class:"w-full",required:""},null,8,["modelValue"])]),_:1})]),n("div",kt,[t(k,null,{default:d(()=>[e[33]||(e[33]=n("label",{for:"dateEnd"},"End Date",-1)),t(C,{modelValue:a.newAdjustment.date_end,"onUpdate:modelValue":e[7]||(e[7]=l=>a.newAdjustment.date_end=l),dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["visible"]),t(P,{header:"Edit Adjustment",visible:a.showEditAdjustmentDialog,"onUpdate:visible":e[18]||(e[18]=l=>a.showEditAdjustmentDialog=l),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:d(()=>[t(D,{label:"Update",icon:"pi pi-check",onClick:a.updateAdjustment,class:"p-button-success"},null,8,["onClick"]),t(D,{label:"Cancel",icon:"pi pi-times",onClick:e[17]||(e[17]=l=>a.showEditAdjustmentDialog=!1),class:"p-button-danger"})]),default:d(()=>[n("div",St,[n("div",Vt,[t(k,null,{default:d(()=>[e[34]||(e[34]=n("label",{for:"adjustmentType"},"Adjustment Type *",-1)),t(N,{modelValue:a.editAdjustment.adjustment_type,"onUpdate:modelValue":e[10]||(e[10]=l=>a.editAdjustment.adjustment_type=l),options:a.adjustmentTypes,optionLabel:"label",optionValue:"value",fluid:"",required:""},null,8,["modelValue","options"])]),_:1})]),n("div",Ft,[t(k,null,{default:d(()=>[e[35]||(e[35]=n("label",{for:"conditionType"},"Condition Type *",-1)),t(N,{modelValue:a.editAdjustment.condition_type,"onUpdate:modelValue":e[11]||(e[11]=l=>a.editAdjustment.condition_type=l),options:a.conditionTypes,optionLabel:"label",optionValue:"value",class:"w-full",onChange:a.updateEditConditionValues,required:""},null,8,["modelValue","options","onChange"])]),_:1})]),n("div",Et,[t(k,null,{default:d(()=>[e[36]||(e[36]=n("label",{for:"adjustmentValue"},"Adjustment Value *",-1)),a.editAdjustment.adjustment_type!=="percentage"?(i(),_("div",xt,[t(B,{modelValue:a.editAdjustment.adjustment_value,"onUpdate:modelValue":e[12]||(e[12]=l=>a.editAdjustment.adjustment_value=l),mode:"currency",currency:"JPY",locale:"ja-JP",class:"w-full",required:""},null,8,["modelValue"])])):(i(),_("div",Tt,[t(B,{modelValue:a.editAdjustment.adjustment_value,"onUpdate:modelValue":e[13]||(e[13]=l=>a.editAdjustment.adjustment_value=l),minFractionDigits:2,maxFractionDigits:2,suffix:"%",class:"w-full",required:""},null,8,["modelValue"])]))]),_:1})]),n("div",Nt,[t(k,null,{default:d(()=>[e[37]||(e[37]=n("label",{for:"conditionValue"},"Condition Value",-1)),t(m,{modelValue:a.selectedEditConditions,"onUpdate:modelValue":e[14]||(e[14]=l=>a.selectedEditConditions=l),placeholder:"Condition Value",options:a.conditionValues,optionLabel:"label",optionValue:"value",maxSelectedLabels:3,class:"w-full"},null,8,["modelValue","options"])]),_:1})]),n("div",Ut,[t(k,null,{default:d(()=>[e[38]||(e[38]=n("label",{for:"dateStart"},"Start Date",-1)),t(C,{modelValue:a.editAdjustment.date_start,"onUpdate:modelValue":e[15]||(e[15]=l=>a.editAdjustment.date_start=l),dateFormat:"yy-mm-dd",class:"w-full",required:""},null,8,["modelValue"])]),_:1})]),n("div",It,[t(k,null,{default:d(()=>[e[39]||(e[39]=n("label",{for:"dateEnd"},"End Date",-1)),t(C,{modelValue:a.editAdjustment.date_end,"onUpdate:modelValue":e[16]||(e[16]=l=>a.editAdjustment.date_end=l),dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["visible"])])):U("",!0)}const Xt=Q(Ue,[["render",Lt]]);export{Xt as default};
//# sourceMappingURL=ManagePlansRates-D5mIYxFm.js.map
