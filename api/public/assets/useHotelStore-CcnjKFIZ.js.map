{"version":3,"file":"useHotelStore-CcnjKFIZ.js","sources":["../../../frontend/src/composables/useReservationStore.js","../../../frontend/src/composables/useHotelStore.js"],"sourcesContent":["    import { ref, watch } from 'vue';\r\n\r\n    // Define shared state outside the function\r\n    const availableRooms = ref([]);\r\n    const reservedRooms = ref([]);\r\n    const holdReservations = ref([]);\r\n    const reservationId = ref(null);\r\n    const reservationDetails = ref({});\r\n\r\n    export function useReservationStore() {\r\n        // Helper\r\n        const formatDate = (date) => {\r\n            const year = date.getFullYear();\r\n            const month = String(date.getMonth() + 1).padStart(2, \"0\");\r\n            const day = String(date.getDate()).padStart(2, \"0\");\r\n            return `${year}-${month}-${day}`;\r\n        };\r\n\r\n        // Set reservationId in the store\r\n        const setReservationId = (id) => {\r\n            reservationId.value = id;\r\n        };\r\n\r\n        // Get reservationId from the store\r\n        const getReservationId = () => {\r\n            return reservationId.value;\r\n        };\r\n    \r\n        // Fetch \r\n        \r\n        const fetchReservation = async (reservation_id) => {\r\n            try {\r\n                const authToken = localStorage.getItem('authToken');\r\n                const url = `/api/reservation/info?id=${reservation_id}`;\r\n                const response = await fetch(url, {\r\n                    method: 'GET',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${authToken}`,\r\n                        'Content-Type': 'application/json',\r\n                    },                \r\n                });\r\n    \r\n                const data = await response.json();\r\n\r\n                if (!response.ok) {\r\n                    throw new Error('Failed to fetch reservation details');\r\n                }\r\n\r\n                // Handle if no reservation was found\r\n                if (data.message) {\r\n                    console.error(data.message); // Log message for debugging\r\n                    reservationDetails.value = {}; // Reset reservationDetails\r\n                    return; // Exit the function early since no reservation was found\r\n                }\r\n\r\n                // Format the date fields for each reservation in the array\r\n                if (Array.isArray(data.reservation)) {\r\n                    data.reservation.forEach((reservation) => {\r\n                        reservation.check_in = formatDate(new Date(reservation.check_in));\r\n                        reservation.check_out = formatDate(new Date(reservation.check_out));\r\n                        reservation.date = formatDate(new Date(reservation.date));\r\n                    });\r\n                }\r\n                \r\n                reservationDetails.value = data;\r\n                reservationId.value = reservation_id;\r\n                    \r\n            } catch (error) {\r\n                console.error('Error fetching reservation:', error);\r\n                reservationDetails.value = {};\r\n                return null;\r\n            }\r\n        };\r\n        \r\n        const fetchAvailableRooms = async (hotelId, startDate, endDate) => {\r\n            try {\r\n                const authToken = localStorage.getItem('authToken');            \r\n                const url = `/api/reservation/available-rooms?hotel_id=${hotelId}&start_date=${startDate}&end_date=${endDate}`;\r\n\r\n                const response = await fetch(url, {\r\n                    method: 'GET',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${authToken}`,\r\n                        'Content-Type': 'application/json',\r\n                    },                \r\n                });\r\n\r\n                if (!response.ok) {\r\n                    const errorText = await response.text();\r\n                    console.error(\"fetchAvailableRooms API Error:\", response.status, response.statusText, errorText);\r\n                    throw new Error(`API returned an error: ${response.status} ${response.statusText} ${errorText}`);\r\n                }\r\n\r\n                const data = await response.json();\r\n\r\n                if (data && data.availableRooms && Array.isArray(data.availableRooms)) {\r\n                    availableRooms.value = data.availableRooms;\r\n                } else if (data && data.message === 'No available rooms for the specified period.') {\r\n                    availableRooms.value = []; // Correctly handle the \"no rooms\" message\r\n                } else if (data && Object.keys(data).length === 0) {\r\n                    availableRooms.value = [];\r\n                }\r\n                else {\r\n                    console.error(\"Invalid API response format:\", data);\r\n                    availableRooms.value = [];\r\n                }\r\n                return response;\r\n\r\n            } catch (error) {\r\n                console.error('Failed to fetch available rooms', error);\r\n                availableRooms.value = [];\r\n            }\r\n        };\r\n\r\n        const fetchReservedRooms = async (hotelId, startDate, endDate) => {\r\n            try {\r\n                const authToken = localStorage.getItem('authToken');            \r\n                const url = `/api/reservation/reserved-rooms?hotel_id=${hotelId}&start_date=${startDate}&end_date=${endDate}`;\r\n\r\n                const response = await fetch(url, {\r\n                    method: 'GET',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${authToken}`,\r\n                        'Content-Type': 'application/json',\r\n                    },                \r\n                });\r\n\r\n                if (!response.ok) {\r\n                    const errorText = await response.text();\r\n                    console.error(\"fetchReservedRooms API Error:\", response.status, response.statusText, errorText);\r\n                    throw new Error(`API returned an error: ${response.status} ${response.statusText} ${errorText}`);\r\n                }\r\n\r\n                const data = await response.json();\r\n\r\n                if (data && data.reservedRooms && Array.isArray(data.reservedRooms)) {\r\n                    reservedRooms.value = data.reservedRooms;\r\n                } else if (data && data.message === 'No reserved rooms for the specified period.') {\r\n                    reservedRooms.value = []; // Correctly handle the \"no rooms\" message\r\n                } else if (data && Object.keys(data).length === 0) {\r\n                    reservedRooms.value = [];\r\n                }\r\n                else {\r\n                    console.error(\"Invalid API response format:\", data);\r\n                    reservedRooms.value = [];\r\n                }\r\n                return response;\r\n\r\n            } catch (error) {\r\n                console.error('Failed to fetch reserved rooms', error);\r\n                reservedRooms.value = [];\r\n            }\r\n        };\r\n\r\n        const fetchMyHoldReservations = async () => {\r\n            try{\r\n                const authToken = localStorage.getItem('authToken');\r\n                const url = `/api/reservation/hold-list`;\r\n\r\n                const response = await fetch(url, {\r\n                    method: 'GET',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${authToken}`,\r\n                        'Content-Type': 'application/json',\r\n                    },                \r\n                });\r\n\r\n                if (!response.ok) {\r\n                    const errorText = await response.text();\r\n                    console.error(\"fetchMyHoldReservations API Error:\", response.status, response.statusText, errorText);\r\n                    throw new Error(`API returned an error: ${response.status} ${response.statusText} ${errorText}`);\r\n                }\r\n\r\n                const data = await response.json();\r\n                if (data.reservations) {\r\n                    // Group by unique combinations of the fields\r\n                    const groupedReservations = {};\r\n\r\n                    data.reservations.forEach(reservation => {\r\n                        const key = `${reservation.hotel_id}-${reservation.reservation_id}-${reservation.client_name}-${reservation.check_in}-${reservation.check_out}-${reservation.number_of_people}`;\r\n                        \r\n                        if (!groupedReservations[key]) {\r\n                            // Store the first occurrence of each unique combination\r\n                            groupedReservations[key] = {\r\n                                hotel_id: reservation.hotel_id,\r\n                                reservation_id: reservation.reservation_id,\r\n                                client_name: reservation.client_name,\r\n                                check_in: formatDate(new Date(reservation.check_in)),\r\n                                check_out: formatDate(new Date(reservation.check_out)),\r\n                                number_of_people: reservation.number_of_people,\r\n                            };\r\n                        }\r\n                    });\r\n\r\n                    // Convert groupedReservations object to an array\r\n                    holdReservations.value = Object.values(groupedReservations);\r\n                }\r\n\r\n                return data;\r\n\r\n            } catch (error) {\r\n                console.error(\"Error fetching hold reservations:\", error);\r\n            }\r\n        };\r\n\r\n    return {\r\n        availableRooms,\r\n        reservedRooms,\r\n        holdReservations,\r\n        reservationId,\r\n        reservationDetails,\r\n        setReservationId,\r\n        getReservationId,\r\n        fetchReservation,\r\n        fetchAvailableRooms,\r\n        fetchReservedRooms,\r\n        fetchMyHoldReservations,        \r\n    };\r\n}\r\n","import { ref, watch } from 'vue';\r\nimport { useReservationStore } from './useReservationStore';\r\n\r\nconst hotels = ref([]);\r\nconst selectedHotel = ref(null);\r\nconst selectedHotelId = ref(null);\r\nconst selectedHotelRooms = ref([]);\r\n\r\nexport function useHotelStore() {\r\n    // Fetch the list of hotels\r\n    const fetchHotels = async () => {\r\n        try {\r\n            const authToken = localStorage.getItem('authToken');\r\n            const response = await fetch('/api/hotel-list', {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${authToken}`,\r\n                    'Content-Type': 'application/json',\r\n                },\r\n            });\r\n            \r\n            hotels.value = await response.json();\r\n\r\n            // Set the first hotel as selected if none is selected\r\n            if (hotels.value.length > 0 && !selectedHotelId.value) {\r\n                selectedHotelId.value = hotels.value[0].id;\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to fetch hotels', error);\r\n        }\r\n    };\r\n\r\n    // Fetch data for the selected hotel\r\n    const fetchHotel = async () => {\r\n        try {\r\n            const authToken = localStorage.getItem('authToken');\r\n            const response = await fetch(`/api/hotel-rooms/${selectedHotelId.value}`, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${authToken}`,\r\n                    'Content-Type': 'application/json',\r\n                },\r\n            });\r\n            \r\n            selectedHotelRooms.value = await response.json();\r\n\r\n            // Update selectedHotel based on selectedHotelId\r\n            selectedHotel.value = hotels.value.find(\r\n                (hotel) => hotel.id === selectedHotelId.value\r\n            );\r\n            \r\n        } catch (error) {\r\n            console.error('Failed to fetch hotel rooms', error);\r\n        }\r\n    };\r\n\r\n    // Watch for changes to selectedHotelId and fetch the corresponding hotel data\r\n    watch(selectedHotelId, (newHotelId) => {\r\n        if (newHotelId) {\r\n            fetchHotel(); // Re-fetch hotel and rooms when the hotel ID changes\r\n        }\r\n    });\r\n/*\r\n    // Watch for changes to reservationId from useReservationStore\r\n    const { reservationId, reservationDetails, fetchReservation } = useReservationStore();\r\n    watch(reservationId, async (newReservationId) => {\r\n        if (newReservationId) {\r\n            // Update selectedHotelId when reservationId changes\r\n            await fetchReservation(newReservationId);\r\n            selectedHotelId.value = reservationDetails.value.hotel_id;\r\n        }\r\n    });\r\n*/\r\n    return {\r\n        hotels,\r\n        selectedHotel,\r\n        selectedHotelId,\r\n        selectedHotelRooms,\r\n        fetchHotels,\r\n        fetchHotel,\r\n    };\r\n}\r\n"],"names":["availableRooms","ref","reservedRooms","holdReservations","reservationId","reservationDetails","useReservationStore","formatDate","date","year","month","day","id","reservation_id","authToken","url","response","data","reservation","error","hotelId","startDate","endDate","errorText","groupedReservations","key","hotels","selectedHotel","selectedHotelId","selectedHotelRooms","useHotelStore","fetchHotels","fetchHotel","hotel","watch","newHotelId"],"mappings":"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"}