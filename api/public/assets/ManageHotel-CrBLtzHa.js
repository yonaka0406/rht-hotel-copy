import{_ as P,u as G,I as g,a4 as q,J as Y,c as M,d as a,a as l,w as i,F as z,b as f,x as K,o as B,z as I,y as Q,A as W,f as X,t as L}from"./index-D1uxBxpa.js";import{a as Z,b as $,s as ee,c as oe,d as le}from"./index-BIeAlUJT.js";import{s as te}from"./index-CZva3LPW.js";import{s as ae}from"./index-B_dfm8Z3.js";import{s as se}from"./index-lMO2XgAy.js";import{s as re}from"./index-Cf12HKFp.js";import{s as ne,a as ie,b as de,c as me}from"./index-CkOVRJJ4.js";import{s as ue}from"./index-SJxkweTD.js";import{s as ce}from"./index-4M-XO5NK.js";import"./index-DU-Aobhb.js";import"./index-OFUA_Emm.js";import"./index-UcX-Yj_6.js";import"./index-BRLBpJjm.js";const h=localStorage.getItem("authToken"),pe={name:"ManageHotel",components:{DataTable:Z,Column:$,Button:te,Dialog:ee,InputText:ae,InputNumber:oe,InputMask:se,Textarea:re,Accordion:ne,AccordionPanel:ie,AccordionHeader:de,AccordionContent:me,Checkbox:le,Select:ue,Panel:ce},setup(){const m=G(),e=g([]),w=g([]),o=q({name:"",description:""}),E=g([]),b=q({floor:1,room_number:"",room_type_id:null,capacity:1,smoking:!1,for_sale:!0}),p=g(!1),u=g(!1),k=g(!1),U=g(!1),v=g(!1),_=g(null),T=g(null),R=g(null);function S(r){const{data:d,newValue:s,field:x}=r;x&&(d[x]=s,d.changed=!0)}const A=async()=>{try{const r=await fetch("/api/hotel-list",{method:"GET",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});e.value=await r.json()}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch hotels",life:3e3})}},C=async()=>{try{const r=await fetch(`/api/hotel-rooms/${_.value.id}`,{headers:{Authorization:`Bearer ${h}`}});if(!r.ok)throw new Error("Failed to fetch room types");const d=await r.json(),s=new Map,x=[];d.forEach(y=>{s.has(y.room_type_id)||s.set(y.room_type_id,{id:y.room_type_id,name:y.room_type_name,description:y.room_type_description});const J={id:y.room_id,room_number:y.room_number,floor:y.room_floor,capacity:y.room_capacity,smoking:y.room_smoking_idc,for_sale:y.room_for_sale_idc,room_type_id:y.room_type_id};x.push(J)}),w.value=Array.from(s.values()),E.value=x}catch(r){console.error("Error fetching room types:",r),m.add({severity:"error",summary:"Error",detail:"Failed to fetch room types",life:3e3})}},V=r=>{_.value={...r},p.value=!0},H=async()=>{try{if(!(await fetch(`/api/hotel/${_.value.id}`,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify(_.value)})).ok)throw new Error("Failed to save hotel");await A(),p.value=!1,m.add({severity:"success",summary:"Success",detail:"Hotel updated successfully",life:3e3})}catch{m.add({severity:"error",summary:"Error",detail:"Failed to save hotel",life:3e3})}},N=async r=>{try{_.value={...r},await C(r.id),U.value=!0}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch rooms",life:3e3})}},F=async()=>{try{const r=new Set;for(const s of E.value){if(r.has(s.room_number)){m.add({severity:"error",summary:"Error",detail:"Room numbers must be unique",life:3e3});return}r.add(s.room_number)}const d=E.value.filter(s=>s.changed);for(const s of d)(await fetch(`/api/room/${s.id}`,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({room_type_id:s.room_type_id,floor:s.floor,room_number:s.room_number,capacity:s.capacity,smoking:s.smoking,for_sale:s.for_sale})})).status===200?console.log(`Room ${s.room_number} updated successfully`):console.error(`Failed to update room ${s.room_number}`);m.add({severity:"success",summary:"Success",detail:"Rooms updated successfully",life:3e3}),u.value=!1}catch{}},D=async r=>{try{_.value={...r},await C(r.id),u.value=!0}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch rooms",life:3e3})}},t=async()=>{try{const r=new Set;for(const s of w.value){if(r.has(s.name)){m.add({severity:"error",summary:"Error",detail:"Room type names must be unique",life:3e3});return}r.add(s.name)}const d=w.value.filter(s=>s.changed);for(const s of d)s.changed&&((await fetch(`/api/room-type/${s.id}`,{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({name:s.name,description:s.description})})).status===200?console.log(`Room type ${s.name} updated successfully`):console.error(`Failed to update room type ${s.name}`));m.add({severity:"success",summary:"Success",detail:"Room types updated successfully",life:3e3}),u.value=!1}catch(r){console.error("Error updating room types:",r)}},n=()=>{Object.assign(o,{name:"",description:""}),u.value=!1,k.value=!0},c=async()=>{const r=new Set;for(const d of w.value)if(r.add(d.name),r.has(o.name)){m.add({severity:"error",summary:"Error",detail:"Room type names must be unique",life:3e3});return}try{const d=await fetch("/api/room-types",{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({name:o.name,description:o.description,hotel_id:_.value.id})});if(d.ok){const s=await d.json();console.log(`Room type ${o.name} created successfully with ID ${s.roomTypeId}`),m.add({severity:"success",summary:"Success",detail:"Room type created successfully",life:3e3}),k.value=!1,await C(),u.value=!0}else console.error(`Failed to create room type ${o.name}`),m.add({severity:"error",summary:"Error",detail:"Failed to create room type",life:3e3})}catch(d){console.error("Error creating room type:",d),m.add({severity:"error",summary:"Error",detail:"Failed to create room type",life:3e3})}},j=()=>{Object.assign(b,{floor:1,room_number:"",room_type_id:null,capacity:1,smoking:!1,for_sale:!0}),U.value=!1,v.value=!0},O=async()=>{const r=new Set;for(const d of E.value)if(r.add(d.room_number),r.has(b.room_number)){m.add({severity:"error",summary:"Error",detail:"Room numbers must be unique",life:3e3});return}try{const d=await fetch("/api/rooms",{method:"POST",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({floor:b.floor,room_number:b.room_number,room_type:!1,room_type_id:b.room_type_id,capacity:b.capacity,smoking:b.smoking,for_sale:b.for_sale,hotel_id:_.value.id})});if(d.ok){const s=await d.json();console.log(`Room ${b.room_number} created successfully`),m.add({severity:"success",summary:"Success",detail:"Room type created successfully",life:3e3}),v.value=!1,await C(),U.value=!0}else console.error(`Failed to create room ${o.name}`),m.add({severity:"error",summary:"Error",detail:"Failed to create room type",life:3e3})}catch(d){console.error("Error creating room:",d),m.add({severity:"error",summary:"Error",detail:"Failed to create room",life:3e3})}};return Y(A),{hotels:e,roomTypes:w,newRoomType:o,rooms:E,newRoom:b,dialogVisible:p,roomTypesDialogVisible:u,roomTypeDialog:k,roomsDialogVisible:U,roomDialog:v,selectedHotel:_,roomTypesDataTable:T,roomsPanel:R,onCellEditComplete:S,editHotel:V,saveHotel:H,editRooms:N,saveRoomChanges:F,editRoomTypes:D,saveRoomTypes:t,openRoomTypeDialog:n,saveRoomType:c,openRoomDialog:j,saveRoom:O}},methods:{formatCurrency(m){return m==null?"":new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(m)}}},fe={class:"p-4"},ye={class:"p-4 max-w-7xl mx-auto"},be={class:"flex flex-col gap-4"},ve={class:"flex flex-col"},_e={class:"flex flex-col"},ge={class:"flex flex-col"},Ve={class:"flex flex-col"},ke={class:"flex flex-col"},Te={class:"flex flex-col"},Re={class:"flex flex-col gap-4"},Ce={class:"flex flex-col"},xe={class:"flex flex-col"},he={class:"flex items-center justify-center"},we={class:"flex items-center justify-center"},Ee={class:"flex items-center justify-center"},Ue={class:"flex items-center justify-center"},De={class:"grid xs:grid-cols-1 grid-cols-2 gap-4"},Se={class:"col-6"},Ae={class:"col-6"},He={class:"col-6"},Ne={class:"col-6"},Fe={class:"col-6"},je={class:"col-6"};function Be(m,e,w,o,E,b){const p=f("Column"),u=f("Button"),k=f("DataTable"),U=f("Panel"),v=f("InputText"),_=f("InputMask"),T=f("InputNumber"),R=f("Dialog"),S=f("Textarea"),A=f("AccordionHeader"),C=f("Select"),V=f("Checkbox"),H=f("AccordionContent"),N=f("AccordionPanel"),F=f("Accordion"),D=K("tooltip");return B(),M(z,null,[a("div",fe,[l(U,{header:"Edit Hotels"},{default:i(()=>[l(k,{value:o.hotels,class:"p-datatable-sm",responsiveLayout:"scroll"},{default:i(()=>[l(p,{field:"formal_name",header:"Formal Name"}),l(p,{field:"name",header:"Name"}),l(p,{field:"email",header:"Email"}),l(p,{field:"phone_number",header:"Phone Number"}),l(p,{header:"Actions"},{body:i(t=>[I(l(u,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:n=>o.editHotel(t.data)},null,8,["onClick"]),[[D,"Edit Hotel"]]),I(l(u,{icon:"pi pi-tag",class:"p-button-text p-button-sm",onClick:n=>o.editRoomTypes(t.data)},null,8,["onClick"]),[[D,"Edit Room Types"]]),I(l(u,{icon:"pi pi-eye",class:"p-button-text p-button-sm",onClick:n=>o.editRooms(t.data)},null,8,["onClick"]),[[D,"View Rooms"]])]),_:1})]),_:1},8,["value"])]),_:1})]),a("div",ye,[l(R,{visible:o.dialogVisible,"onUpdate:visible":e[7]||(e[7]=t=>o.dialogVisible=t),modal:!0,header:"Edit Hotel",style:{width:"450px"},class:"p-fluid"},{footer:i(()=>[l(u,{label:"Save",icon:"pi pi-check",onClick:o.saveHotel,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(u,{label:"Cancel",icon:"pi pi-times",onClick:e[6]||(e[6]=t=>o.dialogVisible=!1),class:"p-button-danger p-button-text p-button-sm",text:""})]),default:i(()=>[a("div",be,[a("div",ve,[e[24]||(e[24]=a("label",{for:"email",class:"font-medium mb-2 block"},"Formal Name",-1)),l(v,{id:"formal_name",modelValue:o.selectedHotel.formal_name,"onUpdate:modelValue":e[0]||(e[0]=t=>o.selectedHotel.formal_name=t),required:""},null,8,["modelValue"])]),a("div",_e,[e[25]||(e[25]=a("label",{for:"email",class:"font-medium mb-2 block"},"Name",-1)),l(v,{id:"name",modelValue:o.selectedHotel.name,"onUpdate:modelValue":e[1]||(e[1]=t=>o.selectedHotel.name=t),required:""},null,8,["modelValue"])]),a("div",ge,[e[26]||(e[26]=a("label",{for:"email",class:"font-medium mb-2 block"},"Email",-1)),l(v,{id:"email",modelValue:o.selectedHotel.email,"onUpdate:modelValue":e[2]||(e[2]=t=>o.selectedHotel.email=t),required:""},null,8,["modelValue"])]),a("div",Ve,[e[27]||(e[27]=a("label",{for:"phone_number",class:"font-medium mb-2 block"},"Phone Number",-1)),l(_,{id:"phone_number",modelValue:o.selectedHotel.phone_number,"onUpdate:modelValue":e[3]||(e[3]=t=>o.selectedHotel.phone_number=t),mask:"(999) 999-9999",required:""},null,8,["modelValue"])]),a("div",ke,[e[28]||(e[28]=a("label",{for:"latitude",class:"font-medium mb-2 block"},"Latitude",-1)),l(T,{id:"latitude",modelValue:o.selectedHotel.latitude,"onUpdate:modelValue":e[4]||(e[4]=t=>o.selectedHotel.latitude=t),minFractionDigits:6},null,8,["modelValue"])]),a("div",Te,[e[29]||(e[29]=a("label",{for:"longitude",class:"font-medium mb-2 block"},"Longitude",-1)),l(T,{id:"longitude",modelValue:o.selectedHotel.longitude,"onUpdate:modelValue":e[5]||(e[5]=t=>o.selectedHotel.longitude=t),minFractionDigits:6},null,8,["modelValue"])])])]),_:1},8,["visible"]),l(R,{visible:o.roomTypesDialogVisible,"onUpdate:visible":e[9]||(e[9]=t=>o.roomTypesDialogVisible=t),modal:!0,header:"Edit Room Types",style:{width:"600px"},class:"p-fluid"},{header:i(()=>[e[30]||(e[30]=a("h2",{class:"text-lg font-bold"},"Edit Room Types",-1)),l(u,{label:"Add Room Type",icon:"pi pi-plus",onClick:o.openRoomTypeDialog,class:"p-button-sm m-2"},null,8,["onClick"])]),footer:i(()=>[l(u,{label:"Save Changes",icon:"pi pi-check",onClick:o.saveRoomTypes,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(u,{label:"Close",icon:"pi pi-times",onClick:e[8]||(e[8]=t=>o.roomTypesDialogVisible=!1),class:"p-button-danger p-button-text p-button-sm"})]),default:i(()=>[e[31]||(e[31]=a("p",null,"Make sure to press ENTER or TAB to confirm the changes before saving.",-1)),e[32]||(e[32]=a("br",null,null,-1)),l(k,{ref:"roomTypesDataTable",value:o.roomTypes,editable:"",editMode:"cell",class:"p-datatable-sm",responsiveLayout:"scroll",onCellEditComplete:o.onCellEditComplete},{default:i(()=>[l(p,{field:"name",header:"Name"},{editor:i(t=>[l(v,{modelValue:t.data.name,"onUpdate:modelValue":n=>t.data.name=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{field:"description",header:"Description"},{editor:i(t=>[l(S,{modelValue:t.data.description,"onUpdate:modelValue":n=>t.data.description=n,autoResize:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["value","onCellEditComplete"])]),_:1},8,["visible"]),l(R,{visible:o.roomTypeDialog,"onUpdate:visible":e[13]||(e[13]=t=>o.roomTypeDialog=t),modal:!0,header:"Add Room Type",style:{width:"450px"},class:"p-fluid"},{footer:i(()=>[l(u,{label:"Add",icon:"pi pi-plus",onClick:o.saveRoomType,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(u,{label:"Close",icon:"pi pi-times",onClick:e[12]||(e[12]=t=>o.roomTypeDialog=!1),class:"p-button-danger p-button-text p-button-sm"})]),default:i(()=>[a("div",Re,[a("div",Ce,[e[33]||(e[33]=a("label",{for:"name",class:"font-medium mb-2 block"},"Room Type Name *",-1)),l(v,{id:"name",modelValue:o.newRoomType.name,"onUpdate:modelValue":e[10]||(e[10]=t=>o.newRoomType.name=t),required:"",autofocus:"",fluid:""},null,8,["modelValue"])]),a("div",xe,[e[34]||(e[34]=a("label",{for:"description",class:"font-medium mb-2 block"},"Description",-1)),l(S,{id:"description",modelValue:o.newRoomType.description,"onUpdate:modelValue":e[11]||(e[11]=t=>o.newRoomType.description=t),rows:"3",autoResize:"",fluid:""},null,8,["modelValue"])])])]),_:1},8,["visible"]),l(R,{visible:o.roomsDialogVisible,"onUpdate:visible":e[15]||(e[15]=t=>o.roomsDialogVisible=t),modal:!0,header:"Edit Rooms",style:{width:"600px"},class:"p-fluid"},{header:i(()=>[e[35]||(e[35]=a("h2",{class:"text-lg font-bold"},"Edit Rooms",-1)),l(u,{label:"Add Room",icon:"pi pi-plus",onClick:o.openRoomDialog,class:"p-button-sm m-2"},null,8,["onClick"])]),footer:i(()=>[l(u,{label:"Save Changes",icon:"pi pi-check",onClick:o.saveRoomChanges,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(u,{label:"Close",icon:"pi pi-times",onClick:e[14]||(e[14]=t=>o.roomsDialogVisible=!1),class:"p-button-danger p-button-text p-button-sm",text:""})]),default:i(()=>[l(F,{activeIndex:0},{default:i(()=>[e[36]||(e[36]=a("p",null,"Make sure to press ENTER or TAB to confirm the changes before saving.",-1)),e[37]||(e[37]=a("br",null,null,-1)),(B(!0),M(z,null,Q(o.roomTypes,t=>(B(),W(N,{ref_for:!0,ref:"roomsPanel",key:t.id,value:t.id},{default:i(()=>[l(A,null,{default:i(()=>[X(" Room Type: "+L(t.name),1)]),_:2},1024),l(H,null,{default:i(()=>[l(k,{value:o.rooms.filter(n=>n.room_type_id===t.id),editMode:"cell",class:"p-datatable-sm",responsiveLayout:"scroll",onCellEditComplete:o.onCellEditComplete},{default:i(()=>[l(p,{field:"room_number",header:"Room Number"},{editor:i(n=>[l(v,{modelValue:n.data.room_number,"onUpdate:modelValue":c=>n.data.room_number=c},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{field:"room_type_id",header:"Room Type"},{body:i(n=>{var c;return[a("span",null,L((c=o.roomTypes.find(j=>j.id===n.data.room_type_id))==null?void 0:c.name),1)]}),editor:i(n=>[l(C,{modelValue:n.data.room_type_id,"onUpdate:modelValue":c=>n.data.room_type_id=c,options:o.roomTypes,optionLabel:"name",optionValue:"id",placeholder:"Select a Room Type"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),l(p,{field:"capacity",header:"Capacity"},{editor:i(n=>[l(T,{modelValue:n.data.capacity,"onUpdate:modelValue":c=>n.data.capacity=c,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(p,{field:"smoking",header:"Smoking"},{body:i(n=>[a("div",he,[l(V,{modelValue:n.data.smoking,"onUpdate:modelValue":c=>n.data.smoking=c,binary:""},null,8,["modelValue","onUpdate:modelValue"])])]),editor:i(n=>[a("div",we,[l(V,{modelValue:n.data.smoking,"onUpdate:modelValue":c=>n.data.smoking=c,binary:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:1}),l(p,{field:"for_sale",header:"For Sale"},{body:i(n=>[a("div",Ee,[l(V,{modelValue:n.data.for_sale,"onUpdate:modelValue":c=>n.data.for_sale=c,binary:""},null,8,["modelValue","onUpdate:modelValue"])])]),editor:i(n=>[a("div",Ue,[l(V,{modelValue:n.data.for_sale,"onUpdate:modelValue":c=>n.data.for_sale=c,binary:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:2},1032,["value","onCellEditComplete"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["visible"]),l(R,{visible:o.roomDialog,"onUpdate:visible":e[23]||(e[23]=t=>o.roomDialog=t),modal:!0,header:"Add Room",style:{width:"450px"},class:"p-fluid"},{footer:i(()=>[l(u,{label:"Add",icon:"pi pi-plus",onClick:o.saveRoom,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(u,{label:"Cancel",icon:"pi pi-times",onClick:e[22]||(e[22]=t=>o.roomDialog=!1),class:"p-button-danger p-button-text p-button-sm"})]),default:i(()=>[a("div",De,[a("div",Se,[e[38]||(e[38]=a("label",{for:"floor",class:"font-medium mb-2 block"},"Floor *",-1)),l(T,{id:"floor",modelValue:o.newRoom.floor,"onUpdate:modelValue":e[16]||(e[16]=t=>o.newRoom.floor=t),min:1,required:""},null,8,["modelValue"])]),a("div",Ae,[e[39]||(e[39]=a("label",{for:"room_number",class:"font-medium mb-2 block"},"Room Number *",-1)),l(v,{id:"room_number",modelValue:o.newRoom.room_number,"onUpdate:modelValue":e[17]||(e[17]=t=>o.newRoom.room_number=t),required:""},null,8,["modelValue"])]),a("div",He,[e[40]||(e[40]=a("label",{for:"room_type_id",class:"font-medium mb-2 block"},"Room Type *",-1)),l(C,{id:"room_type_id",modelValue:o.newRoom.room_type_id,"onUpdate:modelValue":e[18]||(e[18]=t=>o.newRoom.room_type_id=t),options:o.roomTypes,optionLabel:"name",optionValue:"id",placeholder:"Select a Room Type",required:""},null,8,["modelValue","options"])]),a("div",Ne,[e[41]||(e[41]=a("label",{for:"capacity",class:"font-medium mb-2 block"},"Capacity *",-1)),l(T,{id:"capacity",modelValue:o.newRoom.capacity,"onUpdate:modelValue":e[19]||(e[19]=t=>o.newRoom.capacity=t),min:1,required:""},null,8,["modelValue"])]),a("div",Fe,[e[42]||(e[42]=a("label",{for:"smoking",class:"font-medium mb-2 block"},"Smoking",-1)),l(V,{id:"smoking",modelValue:o.newRoom.smoking,"onUpdate:modelValue":e[20]||(e[20]=t=>o.newRoom.smoking=t),binary:""},null,8,["modelValue"])]),a("div",je,[e[43]||(e[43]=a("label",{for:"for_sale",class:"font-medium mb-2 block"},"For Sale",-1)),l(V,{id:"for_sale",modelValue:o.newRoom.for_sale,"onUpdate:modelValue":e[21]||(e[21]=t=>o.newRoom.for_sale=t),binary:""},null,8,["modelValue"])])])]),_:1},8,["visible"])])],64)}const Xe=P(pe,[["render",Be],["__scopeId","data-v-196d6c9e"]]);export{Xe as default};
//# sourceMappingURL=ManageHotel-CrBLtzHa.js.map
