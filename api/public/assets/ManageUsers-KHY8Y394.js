import{_ as H,u as J,h as G,I as c,J as Z,c as k,a as o,w as a,L as Q,b as i,o as u,d as t,A as T,g as K,n as j,t as D,e as p}from"./index-D1uxBxpa.js";import{s as W}from"./index-B_dfm8Z3.js";import{s as X}from"./index-UBclBOx9.js";import{s as Y}from"./index-7jlECg0w.js";import{s as $}from"./index-QDYjf4BC.js";import{s as ee,a as le}from"./index-CZva3LPW.js";import{s as oe}from"./index-4M-XO5NK.js";import{s as se}from"./index-C80g0QIn.js";import{s as te,a as ae,b as re}from"./index-BIeAlUJT.js";import{s as ie,a as ne,b as de}from"./index-SJxkweTD.js";import{s as ce,a as ue,b as me,c as pe}from"./index-CkOVRJJ4.js";import{s as fe}from"./index-OGjolN7Q.js";import{s as ve}from"./index-8v2gNDOB.js";import"./index-UcX-Yj_6.js";import"./index-BRLBpJjm.js";import"./index-DU-Aobhb.js";import"./index-OFUA_Emm.js";const ge={name:"ManageUsers",components:{InputText:W,Password:X,FloatLabel:Y,Card:$,Button:ee,Panel:oe,Divider:se,Dialog:te,Select:ie,Accordion:ce,AccordionPanel:ue,AccordionHeader:me,AccordionContent:pe,Badge:le,OverlayBadge:fe,DataTable:ae,Column:re,IconField:ne,InputIcon:de,ToggleButton:ve},computed:{statusToggle:{get(){return this.currentUser.status===1},set(g){this.currentUser.status=!!g}}},setup(){const g=J();G();const l=c({email:"",password:"",role:null}),m=c({id:null,email:"",role:null,status:!0}),e=c([]),S=c([]),C=c([]),f=c([]),_=c([]),x=c({global:{value:null,matchMode:Q.CONTAINS}}),B=c(!0),h=c(null),b=c(null),y=c(null),A=c(null),E=c(!1),V=c(!1),I=async()=>{const r=localStorage.getItem("authToken");try{const n=await fetch("/api/roles",{method:"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(n.ok){const w=await n.json();e.value=w.map(v=>({...v}))}else console.error("Failed to fetch roles:",n.statusText)}catch(n){console.error("Error fetching roles:",n)}},d=async()=>{const r=localStorage.getItem("authToken");try{const n=await fetch("/api/users",{method:"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(n.ok){const w=await n.json();S.value=w.filter(v=>v.status_id===1),C.value=w.filter(v=>v.status_id===2),f.value=S.value.length,_.value=C.value.length,B.value=!1}else console.error("Failed to fetch users:",n.statusText)}catch(n){console.error("Error fetching users:",n)}},P=async()=>{const r=localStorage.getItem("authToken"),n=l.value.email,w=l.value.password,v=l.value.role;if(s(n),N(w),O(v),!(h.value||b.value||y.value))try{const U=await fetch("/api/user/register",{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({email:n,password:w,role:v})}),q=await U.json();U.ok?(g.add({severity:"success",summary:"Success",detail:"User registered successfully!",life:3e3}),F(),await d()):(g.add({severity:"error",summary:"Error",detail:data.error||"Registration failed.",life:3e3}),apiResponse={type:"error",message:q.error})}catch(U){console.error(U),g.add({severity:"error",summary:"Error",detail:"An error occurred. Please try again.",life:3e3}),apiResponse={type:"error",message:"An error occurred. Please try again."}}},R=async()=>{const r=localStorage.getItem("authToken"),n=m.value.id,w=m.value.role,v=typeof m.value.status=="number"?m.value.status:m.value.status===!0?1:2;try{const U=await fetch("/api/user/update",{method:"PUT",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({id:n,status_id:v,role_id:w})}),q=await U.json();U.ok?(g.add({severity:"success",summary:"Success",detail:"User updated successfully!",life:3e3}),L(),await d()):(g.add({severity:"error",summary:"Error",detail:data.error||"Update failed.",life:3e3}),apiResponse={type:"error",message:q.error})}catch(U){console.error(U),g.add({severity:"error",summary:"Error",detail:"An error occurred. Please try again.",life:3e3}),apiResponse={type:"error",message:"An error occurred. Please try again."}}},M=()=>{E.value=!0},F=()=>{l.email="",l.password="",l.role=null,h.value=null,b.value=null,y.value=null,A.value=null,E.value=!1},z=r=>{m.value={id:r.id,email:r.email,role:r.role_id,status:r.status_id},V.value=!0},L=()=>{m.id=null,m.email="",m.role=null,m.status=!0,y.value=null,V.value=!1},s=r=>{!r||!/\S+@\S+\.\S+/.test(r)?h.value="Please enter a valid email address.":h.value=null},N=r=>{r?/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(r)?b.value="":b.value="Password must have at least 8 characters, one uppercase letter, one lowercase letter, and one number.":b.value="Password is required."},O=r=>{r?y.value=null:y.value="Please select a role."};return Z(()=>{I(),d()}),{newUser:l,currentUser:m,roles:e,activeUsers:S,deactivatedUsers:C,activeUsersCount:f,deactivatedUsersCount:_,filters:x,loading:B,emailError:h,passwordError:b,roleError:y,createUserDialog:E,editUserDialog:V,dialogErrorMessage:A,fetchRoles:I,fetchUsers:d,submitNewUser:P,submitEditUser:R,createUser:M,cancelCreateDialog:F,editUser:z,cancelEditDialog:L,validateEmail:s,validatePassword:N,validateRole:O}}},be={class:"p-4"},ye={class:"text-left"},we={class:"field mb-5 mt-5"},Ue={key:0,class:"p-error text-red-500"},_e={class:"field mb-5 mt-5"},xe={key:1,class:"p-error text-red-500"},he={class:"field mt-5"},ke={key:2,class:"p-error text-red-500"},Ce={key:3,class:"p-error mt-2 text-red-500 text-sm text-center"},Ee={class:"mb-3 mt-5 text-center space-x-2"},Ve={class:"users-management"},Te={class:"flex space-x-4"},De={class:"flex items-center"},Ae={class:"flex justify-end"},Ie={class:"text-center"},Se={class:"flex space-x-4"},Be={class:"flex items-center"},Pe={class:"flex justify-end"},Re={class:"text-center"},Me={class:"field mb-5 mt-5"},Fe={class:"field mt-5"},Le={key:0,class:"p-error text-red-500"},Ne={class:"field mt-5 text-center"},je={key:1,class:"p-error mt-2 text-red-500 text-sm text-center"},ze={class:"mb-3 mt-5 text-center space-x-2"};function qe(g,l,m,e,S,C){const f=i("Button"),_=i("InputText"),x=i("FloatLabel"),B=i("Divider"),h=i("Password"),b=i("Select"),y=i("Dialog"),A=i("Badge"),E=i("AccordionHeader"),V=i("InputIcon"),I=i("IconField"),d=i("Column"),P=i("DataTable"),R=i("AccordionContent"),M=i("AccordionPanel"),F=i("Accordion"),z=i("ToggleButton"),L=i("Panel");return u(),k("div",be,[o(L,{header:"Create & Edit Users"},{default:a(()=>[t("div",null,[t("div",ye,[o(f,{label:"Create User",icon:"pi pi-user-plus",class:"p-button-success mb-4",onClick:e.createUser},null,8,["onClick"])]),e.createUserDialog?(u(),T(y,{key:0,modelValue:e.createUserDialog,"onUpdate:modelValue":l[8]||(l[8]=s=>e.createUserDialog=s),header:"Create New User",visible:e.createUserDialog,style:{width:"450px"},modal:"",closable:!1},{default:a(()=>[t("form",{onSubmit:l[7]||(l[7]=K((...s)=>e.submitNewUser&&e.submitNewUser(...s),["prevent"]))},[t("div",we,[o(x,null,{default:a(()=>[o(_,{id:"email",modelValue:e.newUser.email,"onUpdate:modelValue":l[0]||(l[0]=s=>e.newUser.email=s),class:j(["w-full",{"p-invalid":e.emailError}]),required:"",onBlur:l[1]||(l[1]=s=>e.validateEmail(e.newUser.email))},null,8,["modelValue","class"]),l[19]||(l[19]=t("label",{for:"email"},"Email",-1))]),_:1})]),e.emailError?(u(),k("small",Ue,D(e.emailError),1)):p("",!0),t("div",_e,[o(x,null,{default:a(()=>[o(h,{id:"password",modelValue:e.newUser.password,"onUpdate:modelValue":l[2]||(l[2]=s=>e.newUser.password=s),toggleMask:"",feedback:"",promptLabel:"Choose a password",weakLabel:"Too simple",mediumLabel:"Average complexity",strongLabel:"Complex password",class:j(["w-full",{"p-invalid":e.passwordError}]),required:"",onBlur:l[3]||(l[3]=s=>e.validatePassword(e.newUser.password))},{header:a(()=>l[20]||(l[20]=[t("div",{class:"font-semibold text-xm mb-4"},"Pick a password",-1)])),footer:a(()=>[o(B),l[21]||(l[21]=t("ul",{class:"pl-2 ml-2 my-0 leading-normal"},[t("li",null,"At least one lowercase"),t("li",null,"At least one uppercase"),t("li",null,"At least one numeric"),t("li",null,"Minimum 8 characters")],-1))]),_:1},8,["modelValue","class"]),l[22]||(l[22]=t("label",{for:"password"},"Password",-1))]),_:1})]),e.passwordError?(u(),k("small",xe,D(e.passwordError),1)):p("",!0),t("div",he,[o(x,null,{default:a(()=>[o(b,{id:"role",modelValue:e.newUser.role,"onUpdate:modelValue":l[4]||(l[4]=s=>e.newUser.role=s),options:e.roles,optionLabel:"role_name",optionValue:"id",class:j(["w-full",{"p-invalid":e.roleError}]),required:"",onBlur:l[5]||(l[5]=s=>e.validateRole(e.newUser.role))},null,8,["modelValue","options","class"]),l[23]||(l[23]=t("label",{for:"role"},"Role",-1))]),_:1})]),e.roleError?(u(),k("small",ke,D(e.roleError),1)):p("",!0),e.dialogErrorMessage?(u(),k("div",Ce,D(e.dialogErrorMessage),1)):p("",!0),t("div",Ee,[o(f,{type:"submit",label:"Create User",class:"p-button-success",icon:"pi pi-check",severity:"success"}),o(f,{type:"button",label:"Cancel",class:"p-button-text p-button-secondary",icon:"pi pi-times",severity:"danger",onClick:l[6]||(l[6]=s=>e.cancelCreateDialog())})])],32)]),_:1},8,["modelValue","visible"])):p("",!0),t("div",Ve,[o(F,{activeIndex:0},{default:a(()=>[o(M,{value:"1"},{default:a(()=>[o(E,null,{default:a(()=>[t("div",Te,[l[24]||(l[24]=t("span",{class:"inline"},"Active Users",-1)),t("div",De,[e.activeUsersCount>0?(u(),T(A,{key:0,class:"ml-2",value:e.activeUsersCount,severity:"success"},null,8,["value"])):p("",!0)])])]),_:1}),o(R,null,{default:a(()=>[o(P,{filters:e.filters,"onUpdate:filters":l[10]||(l[10]=s=>e.filters=s),value:e.activeUsers,removableSort:"",paginator:"",rows:10,class:"p-datatable-sm",dataKey:"id",filterDisplay:"row",loading:e.loading,globalFilterFields:["email","role_name"],scrollable:"",responsive:""},{header:a(()=>[t("div",Ae,[o(I,null,{default:a(()=>[o(V,null,{default:a(()=>l[25]||(l[25]=[t("i",{class:"pi pi-search"},null,-1)])),_:1}),o(_,{modelValue:e.filters.global.value,"onUpdate:modelValue":l[9]||(l[9]=s=>e.filters.global.value=s),placeholder:"Keyword Search"},null,8,["modelValue"])]),_:1})])]),default:a(()=>[o(d,{field:"status_id",header:"Status ID",sortable:"",style:{display:"none"}}),o(d,{field:"id",header:"User ID",sortable:"",style:{display:"none"}}),o(d,{field:"email",header:"Email",sortable:"",style:{width:"70%"}}),o(d,{field:"role_id",header:"Role ID",sortable:"",style:{display:"none"}}),o(d,{field:"role_name",header:"Role",sortable:"",style:{width:"20%"}}),o(d,{header:"Actions",style:{width:"10%"}},{body:a(s=>[t("div",Ie,[s.data.id!==1?(u(),T(f,{key:0,icon:"pi pi-pencil",class:"p-button-info p-button-sm",onClick:N=>e.editUser(s.data)},null,8,["onClick"])):p("",!0)])]),_:1})]),_:1},8,["filters","value","loading"])]),_:1})]),_:1}),o(M,{value:"2"},{default:a(()=>[o(E,null,{default:a(()=>[t("div",Se,[l[26]||(l[26]=t("span",{class:"inline"},"Deactivated Users",-1)),t("div",Be,[e.deactivatedUsersCount>0?(u(),T(A,{key:0,class:"ml-2",value:e.deactivatedUsersCount,severity:"danger"},null,8,["value"])):p("",!0)])])]),_:1}),o(R,null,{default:a(()=>[o(P,{filters:e.filters,"onUpdate:filters":l[12]||(l[12]=s=>e.filters=s),value:e.deactivatedUsers,removableSort:"",paginator:"",rows:10,class:"p-datatable-sm",dataKey:"id",filterDisplay:"row",loading:e.loading,globalFilterFields:["email","role_name"],scrollable:"",responsive:""},{header:a(()=>[t("div",Pe,[o(I,null,{default:a(()=>[o(V,null,{default:a(()=>l[27]||(l[27]=[t("i",{class:"pi pi-search"},null,-1)])),_:1}),o(_,{modelValue:e.filters.global.value,"onUpdate:modelValue":l[11]||(l[11]=s=>e.filters.global.value=s),placeholder:"Keyword Search"},null,8,["modelValue"])]),_:1})])]),default:a(()=>[o(d,{field:"email",header:"Email",sortable:"",style:{width:"70%"}}),o(d,{field:"role_id",header:"Role ID",sortable:"",style:{display:"none"}}),o(d,{field:"role_name",header:"Role",sortable:"",style:{width:"20%"}}),o(d,{header:"Actions",style:{width:"10%"}},{body:a(s=>[t("div",Re,[s.data.id!==1?(u(),T(f,{key:0,icon:"pi pi-pencil",class:"p-button-info p-button-sm",onClick:N=>e.editUser(s.data)},null,8,["onClick"])):p("",!0)])]),_:1})]),_:1},8,["filters","value","loading"])]),_:1})]),_:1})]),_:1})]),e.editUserDialog?(u(),T(y,{key:1,modelValue:e.editUserDialog,"onUpdate:modelValue":l[18]||(l[18]=s=>e.editUserDialog=s),header:"Create New User",visible:e.editUserDialog,style:{width:"450px"},modal:"",closable:!1},{default:a(()=>[t("form",{onSubmit:l[17]||(l[17]=K((...s)=>e.submitEditUser&&e.submitEditUser(...s),["prevent"]))},[t("div",Me,[o(x,null,{default:a(()=>[o(_,{id:"eu_email",modelValue:e.currentUser.email,"onUpdate:modelValue":l[13]||(l[13]=s=>e.currentUser.email=s),class:"w-full",disabled:""},null,8,["modelValue"]),l[28]||(l[28]=t("label",{for:"email"},"Email",-1))]),_:1})]),t("div",Fe,[o(x,null,{default:a(()=>[o(b,{id:"role",modelValue:e.currentUser.role,"onUpdate:modelValue":l[14]||(l[14]=s=>e.currentUser.role=s),options:e.roles,optionLabel:"role_name",optionValue:"id",class:j(["w-full",{"p-invalid":e.roleError}]),required:"",onBlur:l[15]||(l[15]=s=>e.validateRole(e.currentUser.role))},null,8,["modelValue","options","class"]),l[29]||(l[29]=t("label",{for:"role"},"Role",-1))]),_:1})]),e.roleError?(u(),k("small",Le,D(e.roleError),1)):p("",!0),t("div",Ne,[o(z,{modelValue:C.statusToggle,"onUpdate:modelValue":l[16]||(l[16]=s=>C.statusToggle=s),onLabel:"Active",offLabel:"Deactivated",onIcon:"pi pi-lock-open",offIcon:"pi pi-lock",class:"w-36","aria-label":"User Status Toggle"},null,8,["modelValue"])]),e.dialogErrorMessage?(u(),k("div",je,D(e.dialogErrorMessage),1)):p("",!0),t("div",ze,[o(f,{type:"submit",label:"Edit User",class:"p-button-warning",icon:"pi pi-pencil",severity:"warning"}),o(f,{type:"button",label:"Cancel",class:"p-button-text p-button-secondary",icon:"pi pi-times",severity:"danger",onClick:e.cancelEditDialog},null,8,["onClick"])])],32)]),_:1},8,["modelValue","visible"])):p("",!0)])]),_:1})])}const rl=H(ge,[["render",qe],["__scopeId","data-v-dcf655a3"]]);export{rl as default};
//# sourceMappingURL=ManageUsers-KHY8Y394.js.map
