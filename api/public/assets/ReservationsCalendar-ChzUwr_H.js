import{_ as E,u as F,I as y,J as L,ap as q,aW as A,c as i,a as J,w as U,b as W,o as c,d as u,F as m,y as h,f,t as p,n as Y,e as v}from"./index-D1uxBxpa.js";import{u as j,a as G}from"./useHotelStore-CcnjKFIZ.js";import"./useClientStore-B-tNQOLN.js";import{s as K}from"./index-4M-XO5NK.js";import"./index-BRLBpJjm.js";import"./index-CZva3LPW.js";const O={name:"ReservationsCalendar",components:{Panel:K},data(){return{}},setup(){F();const{selectedHotel:M,selectedHotelId:l,selectedHotelRooms:x,fetchHotels:s,fetchHotel:I}=j(),{reservedRooms:_,fetchReservedRooms:g,updateReservations:a}=G(),d=y([]),r=y(null),D=y(null);y([]);const R=o=>{const e=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");return`${e}-${t}-${n}`},w=(o,e)=>{const t=[];for(let n=new Date(o);n<=e;n.setDate(n.getDate()+1))t.push(R(new Date(n)));return t},S=async o=>{if(o==="up"){const e=new Date(r.value),t=new Date(r.value);e.setDate(e.getDate()-3),t.setDate(t.getDate()-1);const n=w(e,t);d.value=[...n,...d.value],r.value=R(e),await k()}else if(o==="down"){const e=new Date(D.value),t=new Date(D.value);e.setDate(e.getDate()+1),t.setDate(t.getDate()+3);const n=w(e,t);d.value=[...d.value,...n],D.value=R(t),await k()}},k=async()=>{try{const o=d.value[0],e=d.value[d.value.length-1];await g(l.value,o,e)}catch(o){console.error("Error fetching reservations:",o)}},z=(o,e)=>_.value.some(t=>{const n=R(new Date(t.date));return t.room_id===o&&n===e}),N=(o,e)=>_.value.find(n=>n.room_id===o&&R(new Date(n.date))===e)||{status:"available",client_name:"",reservation_id:null},P=()=>{};let H=null;const T=(o,e)=>(...t)=>{clearTimeout(H),H=setTimeout(()=>o.apply(this,t),e)},V=async o=>{const e=o.target,t=1,n=t,{scrollTop:C,scrollHeight:b,clientHeight:B}=e;e.scrollTop<n?(T(S("up"),200),e.scrollTop=n+10):C+B>=b-t&&T(S("down"),200)};return L(async()=>{await s(),await I();const o=new Date,e=new Date(o);e.setDate(e.getDate()-10);const t=new Date(o);t.setDate(t.getDate()+40),r.value=e,D.value=t,d.value=w(e,t),q(()=>{k();const n=document.querySelector(".table-container");if(n){const b=n.scrollHeight/5;n.scrollTo({top:b,behavior:"smooth"}),n.addEventListener("scroll",V)}})}),A(()=>{}),{dateRange:d,selectedHotelRooms:x,isRoomReserved:z,fillRoomInfo:N,onScroll:P}},methods:{}},Q={class:"p-2"},X={class:"table-auto w-full mb-2"},Z={class:"px-4 py-2 text-center font-bold bg-white sticky left-0 z-10"},$={key:0},ee={key:1};function te(M,l,x,s,I,_){const g=W("Panel");return c(),i("div",Q,[J(g,{header:"Reservations Calendar"},{default:U(()=>[u("div",{class:"table-container",ref:"tableContainer",onScroll:l[0]||(l[0]=(...a)=>s.onScroll&&s.onScroll(...a))},[u("table",X,[u("thead",null,[u("tr",null,[l[2]||(l[2]=u("th",{class:"px-4 py-2 text-center font-bold bg-white sticky top-0 left-0 z-20"},"Date",-1)),(c(!0),i(m,null,h(s.selectedHotelRooms,(a,d)=>(c(),i("th",{key:d,class:"px-4 py-2 text-center sticky top-0 bg-white z-10"},[f(p(a.room_type_name)+" ",1),l[1]||(l[1]=u("br",null,null,-1)),f(" "+p(a.room_number),1)]))),128))])]),u("tbody",null,[(c(!0),i(m,null,h(s.dateRange,(a,d)=>(c(),i("tr",{key:d},[u("td",Z,p(a),1),(c(!0),i(m,null,h(s.selectedHotelRooms,(r,D)=>(c(),i("td",{key:D,class:Y([{"bg-red-100":s.isRoomReserved(r.room_id,a),"cursor-pointer":!0},"px-4 py-2 text-center text-xs"])},[s.isRoomReserved(r.room_id,a)?(c(),i("div",$,[s.fillRoomInfo(r.room_id,a).status==="hold"?(c(),i(m,{key:0},[l[3]||(l[3]=u("i",{class:"pi pi-pause"},null,-1)),f(" "+p(s.fillRoomInfo(r.room_id,a).client_name),1)],64)):v("",!0),s.fillRoomInfo(r.room_id,a).status==="provisory"?(c(),i(m,{key:1},[l[4]||(l[4]=u("i",{class:"pi pi-clock"},null,-1)),f(" "+p(s.fillRoomInfo(r.room_id,a).client_name),1)],64)):v("",!0),s.fillRoomInfo(r.room_id,a).status==="confirmed"?(c(),i(m,{key:2},[l[5]||(l[5]=u("i",{class:"pi pi-check-circle"},null,-1)),f(" "+p(s.fillRoomInfo(r.room_id,a).client_name),1)],64)):v("",!0),s.fillRoomInfo(r.room_id,a).status==="checked_in"?(c(),i(m,{key:3},[l[6]||(l[6]=u("i",{class:"pi pi-user"},null,-1)),f(" "+p(s.fillRoomInfo(r.room_id,a).client_name),1)],64)):v("",!0),s.fillRoomInfo(r.room_id,a).status==="checked_out"?(c(),i(m,{key:4},[l[7]||(l[7]=u("i",{class:"pi pi-sign-out"},null,-1)),f(" "+p(s.fillRoomInfo(r.room_id,a).client_name),1)],64)):v("",!0),s.fillRoomInfo(r.room_id,a).status==="cancelled"?(c(),i(m,{key:5},[l[8]||(l[8]=u("i",{class:"pi pi-times"},null,-1)),f(" "+p(s.fillRoomInfo(r.room_id,a).client_name),1)],64)):v("",!0)])):(c(),i("div",ee,l[9]||(l[9]=[u("i",{class:"pi pi-check"},null,-1),f(" Available ")])))],2))),128))]))),128))])])],544)]),_:1})])}const ie=E(O,[["render",te],["__scopeId","data-v-cfa2e6f7"]]);export{ie as default};
//# sourceMappingURL=ReservationsCalendar-ChzUwr_H.js.map
