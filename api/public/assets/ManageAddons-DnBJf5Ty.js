import{_ as W,u as X,I as b,a5 as Z,J as F,c as G,a as l,w as a,b as m,x as $,o as w,d as n,f as J,A as Y,t as z,e as O,z as q}from"./index-D1uxBxpa.js";import{s as ee}from"./index-4M-XO5NK.js";import{s as oe}from"./index-QDYjf4BC.js";import{s as le,a as te,b as ne,c as ae,d as de}from"./index-Jjwa5XCy.js";import{a as se,b as ie,s as re,c as ue}from"./index-BIeAlUJT.js";import{s as ce,a as pe}from"./index-CZva3LPW.js";import{s as me}from"./index-B_dfm8Z3.js";import{s as be}from"./index-lMO2XgAy.js";import{s as fe}from"./index-Cf12HKFp.js";import{s as ve}from"./index-SJxkweTD.js";import{s as ge}from"./index-7jlECg0w.js";import{s as ye}from"./index-8v2gNDOB.js";import"./index-BRLBpJjm.js";import"./index-Dgpi_Il-.js";import"./index-OFUA_Emm.js";import"./index-DU-Aobhb.js";import"./index-UcX-Yj_6.js";const Ae={name:"ManageAddons",components:{Panel:ee,Card:oe,Tabs:le,TabList:te,Tab:ne,TabPanels:ae,TabPanel:de,DataTable:se,Column:ie,Button:ce,Badge:pe,Dialog:re,InputText:me,InputNumber:ue,InputMask:be,Textarea:fe,Select:ve,FloatLabel:ge,ToggleButton:ye},setup(){const p=X(),e=b(0),L=b([]),o=b([]),g=b([]),A=b(null),T=b(!1),S=b(!1),c=b({name:"",description:"",price:0}),r=b({id:null,name:"",description:"",price:0,visible:!0}),k=b(!1),_=b(!1),h=b({hotel_id:null,name:"",description:"",price:0,addons_global_id:null}),v=b({id:null,hotel_id:null,addons_global_id:null,name:"",description:"",price:0,visible:!0}),H=b(!1),P=b(null),V=Z(()=>A.value?g.value.filter(s=>s.hotel_id===A.value.id):[]),f=async()=>{H.value=!0;try{const d=localStorage.getItem("authToken"),s=await fetch("/api/addons/global",{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();o.value=i}catch(d){console.error("Error fetching global addons:",d),P.value=d.message||"Failed to fetch global addons"}finally{H.value=!1}},C=async()=>{try{const d=localStorage.getItem("authToken"),s=await fetch("/api/hotel-list",{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});L.value=await s.json()}catch{p.add({severity:"error",summary:"Error",detail:"Failed to fetch hotels",life:3e3})}},x=async()=>{H.value=!0;try{const d=localStorage.getItem("authToken"),s=await fetch("/api/addons/hotel",{method:"GET",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();g.value=i}catch(d){console.error("Error fetching hotel addons:",d),P.value=d.message||"Failed to fetch hotel addons"}finally{H.value=!1}},E=async()=>{const d=new Set;for(const s of o.value)if(d.add(s.name),d.has(c.name)){p.add({severity:"error",summary:"Error",detail:"Addon name must be unique",life:3e3});return}try{const s=localStorage.getItem("authToken"),i=await fetch("/api/addons/global",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(c.value)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const u=await i.json();o.value.push(u),T.value=!1,c.value={name:"",description:"",price:0},p.add({severity:"success",summary:"Success",detail:"Global Addon added successfully",life:3e3})}catch(s){console.error("Error saving global addon:",s),p.add({severity:"error",summary:"Error",detail:"Failed to save global addon",life:3e3})}},j=async d=>{r.value={...d},S.value=!0},U=async()=>{const d=o.value.filter(i=>i.id!==r.value.id),s=new Set;for(const i of d)if(s.add(i.name),s.has(r.name)){p.add({severity:"error",summary:"Error",detail:"Addon name must be unique",life:3e3});return}try{const i=localStorage.getItem("authToken"),u=await fetch(`/api/addons/global/${r.value.id}`,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(r.value)});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const y=await u.json(),D=o.value.findIndex(B=>B.id===y.id);D!==-1&&(o.value[D]=y),S.value=!1,r.value={id:null,name:"",description:"",price:0,visible:!0},p.add({severity:"success",summary:"Success",detail:"Global Addon updated successfully",life:3e3})}catch(i){console.error("Error updating global addon:",i),p.add({severity:"error",summary:"Error",detail:"Failed to update global addon",life:3e3})}},I=async()=>{h.value.hotel_id=A.value.id;const d=new Set,s=`${h.value.name}-${h.value.hotel_id}`;for(const i of g.value){const u=`${i.name}-${i.hotel_id}`;if(d.add(u),d.has(s)){p.add({severity:"error",summary:"Error",detail:"Addon name must be unique for the selected hotel",life:3e3});return}}try{const i=localStorage.getItem("authToken"),u=await fetch("/api/addons/hotel",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({...h.value})});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const y=await u.json();g.value.push(y),k.value=!1,h.value={hotel_id:null,name:"",description:"",price:0,addons_global_id:null},p.add({severity:"success",summary:"Success",detail:"Hotel Addon added successfully",life:3e3})}catch(i){console.error("Error saving hotel addon:",i),p.add({severity:"error",summary:"Error",detail:"Failed to save hotel addon",life:3e3})}},t=async d=>{v.value={...d},_.value=!0},N=async()=>{v.value.hotel_id=A.value.id;const d=g.value.filter(u=>u.id!==v.value.id),s=new Set,i=`${v.value.name}-${v.value.hotel_id}`;for(const u of d){const y=`${u.name}-${u.hotel_id}`;if(s.add(y),s.has(i)){p.add({severity:"error",summary:"Error",detail:"Addon name must be unique for the selected hotel",life:3e3});return}}try{const u=localStorage.getItem("authToken"),y=await fetch(`/api/addons/hotel/${v.value.id}`,{method:"PUT",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify(v.value)});if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const D=await y.json(),B=g.value.findIndex(R=>R.id===D.id);B!==-1&&(g.value[B]=D),_.value=!1,v.value={id:null,hotel_id:null,addons_global_id:null,name:"",description:"",price:0,visible:!0},p.add({severity:"success",summary:"Success",detail:"Hotel Addon updated successfully",life:3e3})}catch(u){console.error("Error updating hotel addon:",u),p.add({severity:"error",summary:"Error",detail:"Failed to update hotel addon",life:3e3})}},K=d=>g.value.filter(s=>s.hotel_id===d).length,M=d=>{e.value=d},Q=d=>{A.value=d,e.value=2};return F(f),F(C),F(x),{activeTab:e,hotels:L,globalAddons:o,hotelAddons:g,selectedHotel:A,showGlobalDialog:T,showEditGlobalDialog:S,newGlobalAddon:c,editGlobalAddon:r,showHotelDialog:k,showEditHotelDialog:_,newHotelAddon:h,editHotelAddon:v,filteredHotelAddons:V,saveGlobalAddon:E,openEditGlobalAddon:j,updateGlobalAddon:U,saveHotelAddon:I,openEditHotelDialog:t,updateHotelAddon:N,getAddonsCount:K,onTabChange:M,selectHotel:Q}},methods:{formatCurrency(p){return p==null?"":new Intl.NumberFormat("ja-JP",{style:"currency",currency:"JPY"}).format(p)}}},he={class:"p-4"},we={class:"flex justify-end mb-2"},_e={class:"items-end"},Te={class:"flex items-center justify-center"},ke={key:0,class:"pi pi-eye",style:{color:"green"}},He={key:1,class:"pi pi-eye-slash",style:{color:"red"}},Ve={class:"flex items-center justify-center"},Ce={class:"flex justify-end mb-2"},xe={class:"items-end"},Ee={class:"flex flex-col items-center gap-2 justify-center"},Ge={key:0,class:"pi pi-eye",style:{color:"green"}},Se={key:1,class:"pi pi-eye-slash",style:{color:"red"}},De={key:2,class:"pi pi-link",style:{color:"blue"}},Pe={class:"flex items-center justify-center"},je={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 pt-6"},Ue={class:"col-6"},Ie={class:"col-6"},Ne={class:"pt-6"},Be={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 pt-6"},Je={class:"col-6"},Le={class:"col-6"},Fe={class:"pt-6"},ze={class:"pt-2 flex items-center justify-center"},Oe={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 pt-6"},Ye={class:"col-6"},qe={class:"col-6"},Ke={class:"pt-6"},Me={class:"pt-2"},Qe={class:"grid xs:grid-cols-1 grid-cols-2 gap-2 pt-6"},Re={class:"col-6"},We={class:"col-6"},Xe={class:"pt-6"},Ze={class:"pt-2"},$e={class:"pt-2 flex items-center justify-center"};function eo(p,e,L,o,g,A){const T=m("Tab"),S=m("TabList"),c=m("Button"),r=m("Column"),k=m("DataTable"),_=m("TabPanel"),h=m("Badge"),v=m("TabPanels"),H=m("Tabs"),P=m("Panel"),V=m("InputText"),f=m("FloatLabel"),C=m("InputNumber"),x=m("Textarea"),E=m("Dialog"),j=m("ToggleButton"),U=m("Select"),I=$("tooltip");return w(),G("div",he,[l(P,{header:"Addons"},{default:a(()=>[l(H,{value:o.activeTab,"onUpdate:value":o.onTabChange},{default:a(()=>[l(S,null,{default:a(()=>[l(T,{value:"0"},{default:a(()=>e[26]||(e[26]=[n("i",{class:"pi pi-globe"},null,-1),J(" Global ")])),_:1}),l(T,{value:"1"},{default:a(()=>e[27]||(e[27]=[n("i",{class:"pi pi-building"},null,-1),J(" Hotels ")])),_:1}),o.selectedHotel?(w(),Y(T,{key:0,value:2},{default:a(()=>[e[28]||(e[28]=n("i",{class:"pi pi-building-columns"},null,-1)),J(" "+z(o.selectedHotel.name),1)]),_:1})):O("",!0)]),_:1}),l(v,null,{default:a(()=>[l(_,{value:"0"},{default:a(()=>[n("div",we,[l(c,{onClick:e[0]||(e[0]=t=>o.showGlobalDialog=!0),icon:"pi pi-plus",label:"Add Addon",class:"p-button-right"})]),l(k,{value:o.globalAddons},{default:a(()=>[l(r,{field:"name",header:"Name"}),l(r,{field:"price"},{header:a(()=>e[29]||(e[29]=[n("span",{class:"font-bold items-center"},"Price",-1)])),body:a(t=>[n("span",_e,z(A.formatCurrency(t.data.price)),1)]),_:1}),l(r,{field:"description",header:"Description"}),l(r,{field:"visible"},{header:a(()=>e[30]||(e[30]=[n("span",{class:"font-bold items-center"},"Status",-1)])),body:a(t=>[n("div",Te,[t.data.visible?(w(),G("i",ke)):(w(),G("i",He))])]),_:1}),l(r,null,{header:a(()=>e[31]||(e[31]=[n("span",{class:"font-bold items-center"},"Actions",-1)])),body:a(t=>[n("div",Ve,[q(l(c,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:N=>o.openEditGlobalAddon(t.data)},null,8,["onClick"]),[[I,"Edit Addon"]])])]),_:1})]),_:1},8,["value"])]),_:1}),l(_,{value:"1"},{default:a(()=>[l(k,{value:o.hotels},{default:a(()=>[l(r,{field:"name",header:"Name"}),l(r,null,{header:a(()=>e[32]||(e[32]=[n("span",{class:"font-bold"},"Addons Count",-1)])),body:a(t=>[l(h,{value:o.getAddonsCount(t.data.id),severity:"secondary"},null,8,["value"])]),_:1}),l(r,{header:"Actions"},{body:a(t=>[l(c,{onClick:N=>o.selectHotel(t.data),severity:"info",rounded:""},{default:a(()=>e[33]||(e[33]=[J("Select")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value"])]),_:1}),o.selectedHotel?(w(),Y(_,{key:0,value:2},{default:a(()=>[n("div",Ce,[l(c,{onClick:e[1]||(e[1]=t=>o.showHotelDialog=!0),icon:"pi pi-plus",label:"Add Addon",class:"p-button-right"})]),l(k,{value:o.filteredHotelAddons},{default:a(()=>[l(r,{field:"name",header:"Name"}),l(r,{field:"price"},{header:a(()=>e[34]||(e[34]=[n("span",{class:"font-bold items-center"},"Price",-1)])),body:a(t=>[n("span",xe,z(A.formatCurrency(t.data.price)),1)]),_:1}),l(r,{field:"description",header:"Description"}),l(r,{field:"visible"},{header:a(()=>e[35]||(e[35]=[n("span",{class:"font-bold items-center"},"Status",-1)])),body:a(t=>[n("div",Ee,[t.data.visible?(w(),G("i",Ge)):(w(),G("i",Se)),t.data.addons_global_id?(w(),G("i",De)):O("",!0)])]),_:1}),l(r,null,{header:a(()=>e[36]||(e[36]=[n("span",{class:"font-bold items-center"},"Actions",-1)])),body:a(t=>[n("div",Pe,[q(l(c,{icon:"pi pi-pencil",class:"p-button-text p-button-sm",onClick:N=>o.openEditHotelDialog(t.data)},null,8,["onClick"]),[[I,"Edit Addon"]])])]),_:1})]),_:1},8,["value"])]),_:1})):O("",!0)]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:1}),l(E,{header:"Add New Global Addon",visible:o.showGlobalDialog,"onUpdate:visible":e[6]||(e[6]=t=>o.showGlobalDialog=t),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:a(()=>[l(c,{label:"Save",icon:"pi pi-check",onClick:o.saveGlobalAddon,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(c,{label:"Close",icon:"pi pi-times",onClick:e[5]||(e[5]=t=>o.showGlobalDialog=!1),class:"p-button-danger p-button-text p-button-sm",text:""})]),default:a(()=>[n("div",je,[n("div",Ue,[l(f,null,{default:a(()=>[l(V,{modelValue:o.newGlobalAddon.name,"onUpdate:modelValue":e[2]||(e[2]=t=>o.newGlobalAddon.name=t),fluid:""},null,8,["modelValue"]),e[37]||(e[37]=n("label",null,"Name",-1))]),_:1})]),n("div",Ie,[l(f,null,{default:a(()=>[l(C,{modelValue:o.newGlobalAddon.price,"onUpdate:modelValue":e[3]||(e[3]=t=>o.newGlobalAddon.price=t),mode:"currency",currency:"JPY",locale:"ja-JP",fluid:""},null,8,["modelValue"]),e[38]||(e[38]=n("label",null,"Price",-1))]),_:1})])]),n("div",Ne,[l(f,null,{default:a(()=>[l(x,{modelValue:o.newGlobalAddon.description,"onUpdate:modelValue":e[4]||(e[4]=t=>o.newGlobalAddon.description=t),fluid:""},null,8,["modelValue"]),e[39]||(e[39]=n("label",null,"Description",-1))]),_:1})])]),_:1},8,["visible"]),l(E,{header:"Edit Global Addon",visible:o.showEditGlobalDialog,"onUpdate:visible":e[12]||(e[12]=t=>o.showEditGlobalDialog=t),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:a(()=>[l(c,{label:"Save",icon:"pi pi-check",onClick:o.updateGlobalAddon,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(c,{label:"Close",icon:"pi pi-times",onClick:e[11]||(e[11]=t=>o.showEditGlobalDialog=!1),class:"p-button-danger p-button-text p-button-sm"})]),default:a(()=>[n("div",Be,[n("div",Je,[l(f,null,{default:a(()=>[l(V,{modelValue:o.editGlobalAddon.name,"onUpdate:modelValue":e[7]||(e[7]=t=>o.editGlobalAddon.name=t)},null,8,["modelValue"]),e[40]||(e[40]=n("label",null,"Name",-1))]),_:1})]),n("div",Le,[l(f,null,{default:a(()=>[l(C,{modelValue:o.editGlobalAddon.price,"onUpdate:modelValue":e[8]||(e[8]=t=>o.editGlobalAddon.price=t),mode:"currency",currency:"JPY",locale:"ja-JP"},null,8,["modelValue"]),e[41]||(e[41]=n("label",null,"Price",-1))]),_:1})])]),n("div",Fe,[l(f,null,{default:a(()=>[l(x,{modelValue:o.editGlobalAddon.description,"onUpdate:modelValue":e[9]||(e[9]=t=>o.editGlobalAddon.description=t),fluid:""},null,8,["modelValue"]),e[42]||(e[42]=n("label",null,"Description",-1))]),_:1})]),n("div",ze,[l(j,{id:"visibleToggleEditGlobal",modelValue:o.editGlobalAddon.visible,"onUpdate:modelValue":e[10]||(e[10]=t=>o.editGlobalAddon.visible=t),onLabel:"Visible",offLabel:"Hidden",onIcon:"pi pi-eye",offIcon:"pi pi-eye-slash","aria-label":"Status Toggle"},null,8,["modelValue"])])]),_:1},8,["visible"]),l(E,{header:"Add New Hotel Addon",visible:o.showHotelDialog,"onUpdate:visible":e[18]||(e[18]=t=>o.showHotelDialog=t),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:a(()=>[l(c,{label:"Save",icon:"pi pi-check",onClick:o.saveHotelAddon,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(c,{label:"Close",icon:"pi pi-times",onClick:e[17]||(e[17]=t=>o.showHotelDialog=!1),class:"p-button-danger p-button-text p-button-sm",text:""})]),default:a(()=>[n("div",Oe,[n("div",Ye,[l(f,null,{default:a(()=>[l(V,{modelValue:o.newHotelAddon.name,"onUpdate:modelValue":e[13]||(e[13]=t=>o.newHotelAddon.name=t),fluid:""},null,8,["modelValue"]),e[43]||(e[43]=n("label",null,"Name",-1))]),_:1})]),n("div",qe,[l(f,null,{default:a(()=>[l(C,{modelValue:o.newHotelAddon.price,"onUpdate:modelValue":e[14]||(e[14]=t=>o.newHotelAddon.price=t),mode:"currency",currency:"JPY",locale:"ja-JP",fluid:""},null,8,["modelValue"]),e[44]||(e[44]=n("label",null,"Price",-1))]),_:1})])]),n("div",Ke,[l(f,null,{default:a(()=>[l(x,{modelValue:o.newHotelAddon.description,"onUpdate:modelValue":e[15]||(e[15]=t=>o.newHotelAddon.description=t),fluid:""},null,8,["modelValue"]),e[45]||(e[45]=n("label",null,"Description",-1))]),_:1})]),n("div",Me,[e[46]||(e[46]=n("label",{for:"globalAddonSelect",class:"block mb-2"},"Link to Global Addon (optional)",-1)),l(U,{id:"globalAddonSelect",modelValue:o.newHotelAddon.addons_global_id,"onUpdate:modelValue":e[16]||(e[16]=t=>o.newHotelAddon.addons_global_id=t),options:o.globalAddons,optionLabel:"name",optionValue:"id",placeholder:"Select a Global Addon",class:"w-full",showClear:"",filter:""},null,8,["modelValue","options"])])]),_:1},8,["visible"]),l(E,{header:"Edit Hotel Addon",visible:o.showEditHotelDialog,"onUpdate:visible":e[25]||(e[25]=t=>o.showEditHotelDialog=t),modal:!0,style:{width:"600px"},class:"p-fluid",closable:!0},{footer:a(()=>[l(c,{label:"Save",icon:"pi pi-check",onClick:o.updateHotelAddon,class:"p-button-success p-button-text p-button-sm"},null,8,["onClick"]),l(c,{label:"Close",icon:"pi pi-times",onClick:e[24]||(e[24]=t=>o.showEditHotelDialog=!1),class:"p-button-danger p-button-text p-button-sm"})]),default:a(()=>[n("div",Qe,[n("div",Re,[l(f,null,{default:a(()=>[l(V,{modelValue:o.editHotelAddon.name,"onUpdate:modelValue":e[19]||(e[19]=t=>o.editHotelAddon.name=t)},null,8,["modelValue"]),e[47]||(e[47]=n("label",null,"Name",-1))]),_:1})]),n("div",We,[l(f,null,{default:a(()=>[l(C,{modelValue:o.editHotelAddon.price,"onUpdate:modelValue":e[20]||(e[20]=t=>o.editHotelAddon.price=t),mode:"currency",currency:"JPY",locale:"ja-JP"},null,8,["modelValue"]),e[48]||(e[48]=n("label",null,"Price",-1))]),_:1})])]),n("div",Xe,[l(f,null,{default:a(()=>[l(x,{modelValue:o.editHotelAddon.description,"onUpdate:modelValue":e[21]||(e[21]=t=>o.editHotelAddon.description=t),fluid:""},null,8,["modelValue"]),e[49]||(e[49]=n("label",null,"Description",-1))]),_:1})]),n("div",Ze,[e[50]||(e[50]=n("label",{for:"globalAddonSelectEdit",class:"block mb-2"},"Link to Global Addon (optional)",-1)),l(U,{id:"globalAddonSelectEdit",modelValue:o.editHotelAddon.addons_global_id,"onUpdate:modelValue":e[22]||(e[22]=t=>o.editHotelAddon.addons_global_id=t),options:o.globalAddons,optionLabel:"name",optionValue:"id",placeholder:"Select a Global Addon",class:"w-full",showClear:"",filter:""},null,8,["modelValue","options"])]),n("div",$e,[l(j,{id:"visibleToggleEditHotel",modelValue:o.editHotelAddon.visible,"onUpdate:modelValue":e[23]||(e[23]=t=>o.editHotelAddon.visible=t),onLabel:"Visible",offLabel:"Hidden",onIcon:"pi pi-eye",offIcon:"pi pi-eye-slash","aria-label":"Status Toggle"},null,8,["modelValue"])])]),_:1},8,["visible"])])}const Ao=W(Ae,[["render",eo]]);export{Ao as default};
//# sourceMappingURL=ManageAddons-DnBJf5Ty.js.map
