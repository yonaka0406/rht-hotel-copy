# Fail2Ban filter for PostgreSQL authentication failures
[Definition]
# Common prefix for log lines
__prefix_line = \d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d+ \w+ \[\d+\] 

# Regex to match PostgreSQL authentication failures
failregex = ^%(__prefix_line)sFATAL:\s+no pg_hba\.conf entry for host "<HOST>", user ".*", database ".*", (SSL encryption|no encryption)$
            ^%(__prefix_line)sFATAL:\s+password authentication failed for user ".*"$
            ^%(__prefix_line)sFATAL:\s+role ".*" does not exist$
            ^%(__prefix_line)sFATAL:\s+authentication failed for user ".*"$
            ^%(__prefix_line)sFATAL:\s+unsupported frontend protocol.*$

# Ignore successful connections
ignoreregex = ^%(__prefix_line)sLOG:\s+connection received: host=<HOST> port=\d+$
             ^%(__prefix_line)sLOG:\s+connection authorized: user=.* database=.*$
             ^%(__prefix_line)sLOG:\s+checkpoint.*$
             ^%(__prefix_line)sLOG:\s+starting PostgreSQL.*$
             ^%(__prefix_line)sLOG:\s+database system.*$
             ^%(__prefix_line)sLOG:\s+received.*shutdown.*$
             ^%(__prefix_line)sLOG:\s+shutting down.*$
             ^%(__prefix_line)sLOG:\s+background worker.*$
             ^%(__prefix_line)sWARNING:\s+.*$
             ^%(__prefix_line)sERROR:\s+.*$
